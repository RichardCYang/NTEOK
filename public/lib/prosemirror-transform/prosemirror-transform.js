/* esm.sh - prosemirror-transform@1.9.0 */
function ct(r,t,e){for(let n=0;;n++){if(n==r.childCount||n==t.childCount)return r.childCount==t.childCount?null:e;let i=r.child(n),s=t.child(n);if(i==s){e+=i.nodeSize;continue}if(!i.sameMarkup(s))return e;if(i.isText&&i.text!=s.text){for(let l=0;i.text[l]==s.text[l];l++)e++;return e}if(i.content.size||s.content.size){let l=ct(i.content,s.content,e+1);if(l!=null)return l}e+=i.nodeSize}}function ut(r,t,e,n){for(let i=r.childCount,s=t.childCount;;){if(i==0||s==0)return i==s?null:{a:e,b:n};let l=r.child(--i),o=t.child(--s),h=l.nodeSize;if(l==o){e-=h,n-=h;continue}if(!l.sameMarkup(o))return{a:e,b:n};if(l.isText&&l.text!=o.text){let a=0,f=Math.min(l.text.length,o.text.length);for(;a<f&&l.text[l.text.length-a-1]==o.text[o.text.length-a-1];)a++,e--,n--;return{a:e,b:n}}if(l.content.size||o.content.size){let a=ut(l.content,o.content,e-1,n-1);if(a)return a}e-=h,n-=h}}var m=class r{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let n=0;n<t.length;n++)this.size+=t[n].nodeSize}nodesBetween(t,e,n,i=0,s){for(let l=0,o=0;o<e;l++){let h=this.content[l],a=o+h.nodeSize;if(a>t&&n(h,i+o,s||null,l)!==!1&&h.content.size){let f=o+1;h.nodesBetween(Math.max(0,t-f),Math.min(h.content.size,e-f),n,i+f)}o=a}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,i){let s="",l=!0;return this.nodesBetween(t,e,(o,h)=>{let a=o.isText?o.text.slice(Math.max(t,h)-h,e-h):o.isLeaf?i?typeof i=="function"?i(o):i:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&a||o.isTextblock)&&n&&(l?l=!1:s+=n),s+=a},0),s}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,i=this.content.slice(),s=0;for(e.isText&&e.sameMarkup(n)&&(i[i.length-1]=e.withText(e.text+n.text),s=1);s<t.content.length;s++)i.push(t.content[s]);return new r(i,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let n=[],i=0;if(e>t)for(let s=0,l=0;l<e;s++){let o=this.content[s],h=l+o.nodeSize;h>t&&((l<t||h>e)&&(o.isText?o=o.cut(Math.max(0,t-l),Math.min(o.text.length,e-l)):o=o.cut(Math.max(0,t-l-1),Math.min(o.content.size,e-l-1))),n.push(o),i+=o.nodeSize),l=h}return new r(n,i)}cutByIndex(t,e){return t==e?r.empty:t==0&&e==this.content.length?this:new r(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let i=this.content.slice(),s=this.size+e.nodeSize-n.nodeSize;return i[t]=e,new r(i,s)}addToStart(t){return new r([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new r(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let i=this.content[e];t(i,n,e),n+=i.nodeSize}}findDiffStart(t,e=0){return ct(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return ut(this,t,e,n)}findIndex(t){if(t==0)return P(0,t);if(t==this.size)return P(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let e=0,n=0;;e++){let i=this.child(e),s=n+i.nodeSize;if(s>=t)return s==t?P(e+1,s):P(e,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return r.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new r(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return r.empty;let e,n=0;for(let i=0;i<t.length;i++){let s=t[i];n+=s.nodeSize,i&&s.isText&&t[i-1].sameMarkup(s)?(e||(e=t.slice(0,i)),e[e.length-1]=s.withText(e[e.length-1].text+s.text)):e&&e.push(s)}return new r(e||t,n)}static from(t){if(!t)return r.empty;if(t instanceof r)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new r([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};m.empty=new m([],0);var K={index:0,offset:0};function P(r,t){return K.index=r,K.offset=t,K}function L(r,t){if(r===t)return!0;if(!(r&&typeof r=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(r);if(Array.isArray(t)!=e)return!1;if(e){if(r.length!=t.length)return!1;for(let n=0;n<r.length;n++)if(!L(r[n],t[n]))return!1}else{for(let n in r)if(!(n in t)||!L(r[n],t[n]))return!1;for(let n in t)if(!(n in r))return!1}return!0}var S=class r{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let i=0;i<t.length;i++){let s=t[i];if(this.eq(s))return t;if(this.type.excludes(s.type))e||(e=t.slice(0,i));else{if(s.type.excludes(this.type))return t;!n&&s.type.rank>this.type.rank&&(e||(e=t.slice(0,i)),e.push(this),n=!0),e&&e.push(s)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&L(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);let i=n.create(e.attrs);return n.checkAttrs(i.attrs),i}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return r.none;if(t instanceof r)return[t];let e=t.slice();return e.sort((n,i)=>n.type.rank-i.type.rank),e}};S.none=[];var T=class extends Error{},g=class r{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=dt(this.content,t+this.openStart,e);return n&&new r(n,this.openStart,this.openEnd)}removeBetween(t,e){return new r(pt(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return r.empty;let n=e.openStart||0,i=e.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new r(m.fromJSON(t,e.content),n,i)}static maxOpen(t,e=!0){let n=0,i=0;for(let s=t.firstChild;s&&!s.isLeaf&&(e||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=t.lastChild;s&&!s.isLeaf&&(e||!s.type.spec.isolating);s=s.lastChild)i++;return new r(t,n,i)}};g.empty=new g(m.empty,0,0);function pt(r,t,e){let{index:n,offset:i}=r.findIndex(t),s=r.maybeChild(n),{index:l,offset:o}=r.findIndex(e);if(i==t||s.isText){if(o!=e&&!r.child(l).isText)throw new RangeError("Removing non-flat range");return r.cut(0,t).append(r.cut(e))}if(n!=l)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(pt(s.content,t-i-1,e-i-1)))}function dt(r,t,e,n){let{index:i,offset:s}=r.findIndex(t),l=r.maybeChild(i);if(s==t||l.isText)return n&&!n.canReplace(i,i,e)?null:r.cut(0,t).append(e).append(r.cut(t));let o=dt(l.content,t-s-1,e,l);return o&&r.replaceChild(i,l.copy(o))}function Jt(r,t,e){if(e.openStart>r.depth)throw new T("Inserted content deeper than insertion position");if(r.depth-e.openStart!=t.depth-e.openEnd)throw new T("Inconsistent open depths");return mt(r,t,e,0)}function mt(r,t,e,n){let i=r.index(n),s=r.node(n);if(i==t.index(n)&&n<r.depth-e.openStart){let l=mt(r,t,e,n+1);return s.copy(s.content.replaceChild(i,l))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&r.depth==n&&t.depth==n){let l=r.parent,o=l.content;return O(l,o.cut(0,r.parentOffset).append(e.content).append(o.cut(t.parentOffset)))}else{let{start:l,end:o}=Bt(e,r);return O(s,yt(r,l,o,t,n))}else return O(s,q(r,t,n))}function gt(r,t){if(!t.type.compatibleContent(r.type))throw new T("Cannot join "+t.type.name+" onto "+r.type.name)}function Q(r,t,e){let n=r.node(e);return gt(n,t.node(e)),n}function M(r,t){let e=t.length-1;e>=0&&r.isText&&r.sameMarkup(t[e])?t[e]=r.withText(t[e].text+r.text):t.push(r)}function I(r,t,e,n){let i=(t||r).node(e),s=0,l=t?t.index(e):i.childCount;r&&(s=r.index(e),r.depth>e?s++:r.textOffset&&(M(r.nodeAfter,n),s++));for(let o=s;o<l;o++)M(i.child(o),n);t&&t.depth==e&&t.textOffset&&M(t.nodeBefore,n)}function O(r,t){return r.type.checkContent(t),r.copy(t)}function yt(r,t,e,n,i){let s=r.depth>i&&Q(r,t,i+1),l=n.depth>i&&Q(e,n,i+1),o=[];return I(null,r,i,o),s&&l&&t.index(i)==e.index(i)?(gt(s,l),M(O(s,yt(r,t,e,n,i+1)),o)):(s&&M(O(s,q(r,t,i+1)),o),I(t,e,i,o),l&&M(O(l,q(e,n,i+1)),o)),I(n,null,i,o),new m(o)}function q(r,t,e){let n=[];if(I(null,r,e,n),r.depth>e){let i=Q(r,t,e+1);M(O(i,q(r,t,e+1)),n)}return I(t,null,e,n),new m(n)}function Bt(r,t){let e=t.depth-r.openStart,i=t.node(e).copy(r.content);for(let s=e-1;s>=0;s--)i=t.node(s).copy(m.from(i));return{start:i.resolveNoCache(r.openStart+e),end:i.resolveNoCache(i.content.size-r.openEnd-e)}}var U=class r{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=t.child(e);return n?t.child(e).cut(n):i}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[e*3],i=e==0?0:this.path[e*3-1]+1;for(let s=0;s<t;s++)i+=n.child(s).nodeSize;return i}marks(){let t=this.parent,e=this.index();if(t.content.size==0)return S.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),i=t.maybeChild(e);if(!n){let o=n;n=i,i=o}let s=n.marks;for(var l=0;l<s.length;l++)s[l].type.spec.inclusive===!1&&(!i||!s[l].isInSet(i.marks))&&(s=s[l--].removeFromSet(s));return s}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,i=t.parent.maybeChild(t.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new Y(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],i=0,s=e;for(let l=t;;){let{index:o,offset:h}=l.content.findIndex(s),a=s-h;if(n.push(l,o,i+h),!a||(l=l.child(o),l.isText))break;s=a-1,i+=h+1}return new r(e,n,s)}static resolveCached(t,e){let n=ht.get(t);if(n)for(let s=0;s<n.elts.length;s++){let l=n.elts[s];if(l.pos==e)return l}else ht.set(t,n=new X);let i=n.elts[n.i]=r.resolve(t,e);return n.i=(n.i+1)%Dt,i}},X=class{constructor(){this.elts=[],this.i=0}},Dt=12,ht=new WeakMap,Y=class{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},Wt=Object.create(null),Z=class r{constructor(t,e,n,i=S.none){this.type=t,this.attrs=e,this.marks=i,this.content=n||m.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,i=0){this.content.nodesBetween(t,e,n,i,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,i){return this.content.textBetween(t,e,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&L(this.attrs,e||t.defaultAttrs||Wt)&&S.sameSet(this.marks,n||S.none)}copy(t=null){return t==this.content?this:new r(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new r(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return g.empty;let i=this.resolve(t),s=this.resolve(e),l=n?0:i.sharedDepth(e),o=i.start(l),a=i.node(l).content.cut(i.pos-o,s.pos-o);return new g(a,i.depth-l,s.depth-l)}replace(t,e,n){return Jt(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:i}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(i==t||e.isText)return e;t-=i+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let i=this.content.child(e-1);return{node:i,index:e-1,offset:n-i.nodeSize}}resolve(t){return U.resolveCached(this,t)}resolveNoCache(t){return U.resolve(this,t)}rangeHasMark(t,e,n){let i=!1;return e>t&&this.nodesBetween(t,e,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),Pt(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=m.empty,i=0,s=n.childCount){let l=this.contentMatchAt(t).matchFragment(n,i,s),o=l&&l.matchFragment(this.content,e);if(!o||!o.validEnd)return!1;for(let h=i;h<s;h++)if(!this.type.allowsMarks(n.child(h).marks))return!1;return!0}canReplaceWith(t,e,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(t).matchType(n),l=s&&s.matchFragment(this.content,e);return l?l.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=S.none;for(let e=0;e<this.marks.length;e++){let n=this.marks[e];n.type.checkAttrs(n.attrs),t=n.addToSet(t)}if(!S.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(e=>e.toJSON())),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let i=m.fromJSON(t,e.content),s=t.nodeType(e.type).create(e.attrs,i,n);return s.type.checkAttrs(s.attrs),s}};Z.prototype.text=void 0;function Pt(r,t){for(let e=r.length-1;e>=0;e--)t=r[e].type.name+"("+t+")";return t}var z=class r{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let n=new $(t,e);if(n.next==null)return r.empty;let i=xt(n);n.next&&n.err("Unexpected trailing text");let s=jt(Ht(i));return Kt(s,n),s}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,n=t.childCount){let i=this;for(let s=e;i&&s<n;s++)i=i.matchType(t.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1}fillBefore(t,e=!1,n=0){let i=[this];function s(l,o){let h=l.matchFragment(t,n);if(h&&(!e||h.validEnd))return m.from(o.map(a=>a.createAndFill()));for(let a=0;a<l.next.length;a++){let{type:f,next:u}=l.next[a];if(!(f.isText||f.hasRequiredAttrs())&&i.indexOf(u)==-1){i.push(u);let c=s(u,o.concat(f));if(c)return c}}return null}return s(this,[])}findWrapping(t){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==t)return this.wrapCache[n+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(t)){let l=[];for(let o=i;o.type;o=o.via)l.push(o.type);return l.reverse()}for(let l=0;l<s.next.length;l++){let{type:o,next:h}=s.next[l];!o.isLeaf&&!o.hasRequiredAttrs()&&!(o.name in e)&&(!i.type||h.validEnd)&&(n.push({match:o.contentMatch,type:o,via:i}),e[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(n){t.push(n);for(let i=0;i<n.next.length;i++)t.indexOf(n.next[i].next)==-1&&e(n.next[i].next)}return e(this),t.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let l=0;l<n.next.length;l++)s+=(l?", ":"")+n.next[l].type.name+"->"+t.indexOf(n.next[l].next);return s}).join(`
`)}};z.empty=new z(!0);var $=class{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}};function xt(r){let t=[];do t.push(Lt(r));while(r.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function Lt(r){let t=[];do t.push(qt(r));while(r.next&&r.next!=")"&&r.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function qt(r){let t=Gt(r);for(;;)if(r.eat("+"))t={type:"plus",expr:t};else if(r.eat("*"))t={type:"star",expr:t};else if(r.eat("?"))t={type:"opt",expr:t};else if(r.eat("{"))t=Ut(r,t);else break;return t}function at(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let t=Number(r.next);return r.pos++,t}function Ut(r,t){let e=at(r),n=e;return r.eat(",")&&(r.next!="}"?n=at(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:e,max:n,expr:t}}function Vt(r,t){let e=r.nodeTypes,n=e[t];if(n)return[n];let i=[];for(let s in e){let l=e[s];l.isInGroup(t)&&i.push(l)}return i.length==0&&r.err("No node type or group '"+t+"' found"),i}function Gt(r){if(r.eat("(")){let t=xt(r);return r.eat(")")||r.err("Missing closing paren"),t}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let t=Vt(r,r.next).map(e=>(r.inline==null?r.inline=e.isInline:r.inline!=e.isInline&&r.err("Mixing inline and block content"),{type:"name",value:e}));return r.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function Ht(r){let t=[[]];return i(s(r,0),e()),t;function e(){return t.push([])-1}function n(l,o,h){let a={term:h,to:o};return t[l].push(a),a}function i(l,o){l.forEach(h=>h.to=o)}function s(l,o){if(l.type=="choice")return l.exprs.reduce((h,a)=>h.concat(s(a,o)),[]);if(l.type=="seq")for(let h=0;;h++){let a=s(l.exprs[h],o);if(h==l.exprs.length-1)return a;i(a,o=e())}else if(l.type=="star"){let h=e();return n(o,h),i(s(l.expr,h),h),[n(h)]}else if(l.type=="plus"){let h=e();return i(s(l.expr,o),h),i(s(l.expr,h),h),[n(h)]}else{if(l.type=="opt")return[n(o)].concat(s(l.expr,o));if(l.type=="range"){let h=o;for(let a=0;a<l.min;a++){let f=e();i(s(l.expr,h),f),h=f}if(l.max==-1)i(s(l.expr,h),h);else for(let a=l.min;a<l.max;a++){let f=e();n(h,f),i(s(l.expr,h),f),h=f}return[n(h)]}else{if(l.type=="name")return[n(o,void 0,l.value)];throw new Error("Unknown expr type")}}}}function wt(r,t){return t-r}function ft(r,t){let e=[];return n(t),e.sort(wt);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);e.push(i);for(let l=0;l<s.length;l++){let{term:o,to:h}=s[l];!o&&e.indexOf(h)==-1&&n(h)}}}function jt(r){let t=Object.create(null);return e(ft(r,0));function e(n){let i=[];n.forEach(l=>{r[l].forEach(({term:o,to:h})=>{if(!o)return;let a;for(let f=0;f<i.length;f++)i[f][0]==o&&(a=i[f][1]);ft(r,h).forEach(f=>{a||i.push([o,a=[]]),a.indexOf(f)==-1&&a.push(f)})})});let s=t[n.join(",")]=new z(n.indexOf(r.length-1)>-1);for(let l=0;l<i.length;l++){let o=i[l][1].sort(wt);s.next.push({type:i[l][0],next:t[o.join(",")]||e(o)})}return s}}function Kt(r,t){for(let e=0,n=[r];e<n.length;e++){let i=n[e],s=!i.validEnd,l=[];for(let o=0;o<i.next.length;o++){let{type:h,next:a}=i.next[o];l.push(h.name),s&&!(h.isText||h.hasRequiredAttrs())&&(s=!1),n.indexOf(a)==-1&&n.push(a)}s&&t.err("Only non-generatable nodes ("+l.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Qt(r){let t=Object.create(null);for(let e in r){let n=r[e];if(!n.hasDefault)return null;t[e]=n.default}return t}function Xt(r,t){let e=Object.create(null);for(let n in r){let i=t&&t[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}e[n]=i}return e}function Yt(r,t,e,n){for(let i in t)if(!(i in r))throw new RangeError(`Unsupported attribute ${i} for ${e} of type ${i}`);for(let i in r){let s=r[i];s.validate&&s.validate(t[i])}}function Zt(r,t){let e=Object.create(null);if(t)for(let n in t)e[n]=new _(r,n,t[n]);return e}function $t(r,t,e){let n=e.split("|");return i=>{let s=i===null?"null":typeof i;if(n.indexOf(s)<0)throw new RangeError(`Expected value of type ${n} for attribute ${t} on type ${r}, got ${s}`)}}var _=class{constructor(t,e,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?$t(t,e,n.validate):n.validate}get isRequired(){return!this.hasDefault}},V=class r{constructor(t,e,n,i){this.name=t,this.rank=e,this.schema=n,this.spec=i,this.attrs=Zt(t,i.attrs),this.excluded=null;let s=Qt(this.attrs);this.instance=s?new S(this,s):null}create(t=null){return!t&&this.instance?this.instance:new S(this,Xt(this.attrs,t))}static compile(t,e){let n=Object.create(null),i=0;return t.forEach((s,l)=>n[s]=new r(s,i++,e,l)),n}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}checkAttrs(t){Yt(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}};var Et=65535,Ct=Math.pow(2,16);function _t(r,t){return r+t*Ct}function kt(r){return r&Et}function te(r){return(r-(r&Et))/Ct}var bt=1,Mt=2,G=4,Ot=8,J=class{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(this.delInfo&Ot)>0}get deletedBefore(){return(this.delInfo&(bt|G))>0}get deletedAfter(){return(this.delInfo&(Mt|G))>0}get deletedAcross(){return(this.delInfo&G)>0}},E=class r{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&r.empty)return r.empty}recover(t){let e=0,n=kt(t);if(!this.inverted)for(let i=0;i<n;i++)e+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+e+te(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let i=0,s=this.inverted?2:1,l=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let h=this.ranges[o]-(this.inverted?i:0);if(h>t)break;let a=this.ranges[o+s],f=this.ranges[o+l],u=h+a;if(t<=u){let c=a?t==h?-1:t==u?1:e:e,p=h+i+(c<0?0:f);if(n)return p;let d=t==(e<0?h:u)?null:_t(o/3,t-h),y=t==h?Mt:t==u?bt:G;return(e<0?t!=h:t!=u)&&(y|=Ot),new J(p,y,d)}i+=f-a}return n?t+i:new J(t+i,0,null)}touches(t,e){let n=0,i=kt(e),s=this.inverted?2:1,l=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let h=this.ranges[o]-(this.inverted?n:0);if(h>t)break;let a=this.ranges[o+s],f=h+a;if(t<=f&&o==i*3)return!0;n+=this.ranges[o+l]-a}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let l=this.ranges[i],o=l-(this.inverted?s:0),h=l+(this.inverted?0:s),a=this.ranges[i+e],f=this.ranges[i+n];t(o,o+a,h,h+f),s+=f-a}}invert(){return new r(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?r.empty:new r(t<0?[0,-t,0]:[0,0,t])}};E.empty=new E([]);var it=class r{constructor(t=[],e,n=0,i=t.length){this.maps=t,this.mirror=e,this.from=n,this.to=i}slice(t=0,e=this.maps.length){return new r(this.maps,this.mirror,t,e)}copy(){return new r(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(t,e){this.to=this.maps.push(t),e!=null&&this.setMirror(this.maps.length-1,e)}appendMapping(t){for(let e=0,n=this.maps.length;e<t.maps.length;e++){let i=t.getMirror(e);this.appendMap(t.maps[e],i!=null&&i<e?n+i:void 0)}}getMirror(t){if(this.mirror){for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){let i=t.getMirror(e);this.appendMap(t.maps[e].invert(),i!=null&&i>e?n-i-1:void 0)}}invert(){let t=new r;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,n){let i=0;for(let s=this.from;s<this.to;s++){let l=this.maps[s],o=l.mapResult(t,e);if(o.recover!=null){let h=this.getMirror(s);if(h!=null&&h>s&&h<this.to){s=h,t=this.maps[h].recover(o.recover);continue}}i|=o.delInfo,t=o.pos}return n?t:new J(t,i,null)}},tt=Object.create(null),x=class{getMap(){return E.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=tt[e.stepType];if(!n)throw new RangeError(`No step type ${e.stepType} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in tt)throw new RangeError("Duplicate use of step JSON ID "+t);return tt[t]=e,e.prototype.jsonID=t,e}},w=class r{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new r(t,null)}static fail(t){return new r(null,t)}static fromReplace(t,e,n,i){try{return r.ok(t.replace(e,n,i))}catch(s){if(s instanceof T)return r.fail(s.message);throw s}}};function lt(r,t,e){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(lt(s.content,t,s))),s.isInline&&(s=t(s,e,i)),n.push(s)}return m.fromArray(n)}var B=class r extends x{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new g(lt(e.content,(l,o)=>!l.isAtom||!o.type.allowsMarkType(this.mark.type)?l:l.mark(this.mark.addToSet(l.marks)),i),e.openStart,e.openEnd);return w.fromReplace(t,this.from,this.to,s)}invert(){return new N(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new r(e.pos,n.pos,this.mark)}merge(t){return t instanceof r&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new r(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new r(e.from,e.to,t.markFromJSON(e.mark))}};x.jsonID("addMark",B);var N=class r extends x{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new g(lt(e.content,i=>i.mark(this.mark.removeFromSet(i.marks)),t),e.openStart,e.openEnd);return w.fromReplace(t,this.from,this.to,n)}invert(){return new B(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new r(e.pos,n.pos,this.mark)}merge(t){return t instanceof r&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new r(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new r(e.from,e.to,t.markFromJSON(e.mark))}};x.jsonID("removeMark",N);var D=class r extends x{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return w.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return w.fromReplace(t,this.pos,this.pos+1,new g(m.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let n=this.mark.addToSet(e.marks);if(n.length==e.marks.length){for(let i=0;i<e.marks.length;i++)if(!e.marks[i].isInSet(n))return new r(this.pos,e.marks[i]);return new r(this.pos,this.mark)}}return new W(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new r(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new r(e.pos,t.markFromJSON(e.mark))}};x.jsonID("addNodeMark",D);var W=class r extends x{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return w.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return w.fromReplace(t,this.pos,this.pos+1,new g(m.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return!e||!this.mark.isInSet(e.marks)?this:new D(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new r(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new r(e.pos,t.markFromJSON(e.mark))}};x.jsonID("removeNodeMark",W);var v=class r extends x{constructor(t,e,n,i=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=i}apply(t){return this.structure&&rt(t,this.from,this.to)?w.fail("Structure replace would overwrite content"):w.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new E([this.from,this.to-this.from,this.slice.size])}invert(t){return new r(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new r(e.pos,Math.max(e.pos,n.pos),this.slice)}merge(t){if(!(t instanceof r)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let e=this.slice.size+t.slice.size==0?g.empty:new g(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new r(this.from,this.to+(t.to-t.from),e,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let e=this.slice.size+t.slice.size==0?g.empty:new g(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new r(t.from,this.to,e,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new r(e.from,e.to,g.fromJSON(t,e.slice),!!e.structure)}};x.jsonID("replace",v);var C=class r extends x{constructor(t,e,n,i,s,l,o=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=l,this.structure=o}apply(t){if(this.structure&&(rt(t,this.from,this.gapFrom)||rt(t,this.gapTo,this.to)))return w.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return w.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?w.fromReplace(t,this.from,this.to,n):w.fail("Content does not fit in gap")}getMap(){return new E([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new r(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),i=this.from==this.gapFrom?e.pos:t.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||i<e.pos||s>n.pos?null:new r(e.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number"||typeof e.gapFrom!="number"||typeof e.gapTo!="number"||typeof e.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new r(e.from,e.to,e.gapFrom,e.gapTo,g.fromJSON(t,e.slice),e.insert,!!e.structure)}};x.jsonID("replaceAround",C);function rt(r,t,e){let n=r.resolve(t),i=e-t,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let l=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!l||l.isLeaf)return!0;l=l.firstChild,i--}}return!1}function ee(r,t,e,n){let i=[],s=[],l,o;r.doc.nodesBetween(t,e,(h,a,f)=>{if(!h.isInline)return;let u=h.marks;if(!n.isInSet(u)&&f.type.allowsMarkType(n.type)){let c=Math.max(a,t),p=Math.min(a+h.nodeSize,e),d=n.addToSet(u);for(let y=0;y<u.length;y++)u[y].isInSet(d)||(l&&l.to==c&&l.mark.eq(u[y])?l.to=p:i.push(l=new N(c,p,u[y])));o&&o.to==c?o.to=p:s.push(o=new B(c,p,n))}}),i.forEach(h=>r.step(h)),s.forEach(h=>r.step(h))}function ne(r,t,e,n){let i=[],s=0;r.doc.nodesBetween(t,e,(l,o)=>{if(!l.isInline)return;s++;let h=null;if(n instanceof V){let a=l.marks,f;for(;f=n.isInSet(a);)(h||(h=[])).push(f),a=f.removeFromSet(a)}else n?n.isInSet(l.marks)&&(h=[n]):h=l.marks;if(h&&h.length){let a=Math.min(o+l.nodeSize,e);for(let f=0;f<h.length;f++){let u=h[f],c;for(let p=0;p<i.length;p++){let d=i[p];d.step==s-1&&u.eq(i[p].style)&&(c=d)}c?(c.to=a,c.step=s):i.push({style:u,from:Math.max(o,t),to:a,step:s})}}}),i.forEach(l=>r.step(new N(l.from,l.to,l.style)))}function Tt(r,t,e,n=e.contentMatch,i=!0){let s=r.doc.nodeAt(t),l=[],o=t+1;for(let h=0;h<s.childCount;h++){let a=s.child(h),f=o+a.nodeSize,u=n.matchType(a.type);if(!u)l.push(new v(o,f,g.empty));else{n=u;for(let c=0;c<a.marks.length;c++)e.allowsMarkType(a.marks[c].type)||r.step(new N(o,f,a.marks[c]));if(i&&a.isText&&e.whitespace!="pre"){let c,p=/\r?\n|\r/g,d;for(;c=p.exec(a.text);)d||(d=new g(m.from(e.schema.text(" ",e.allowedMarks(a.marks))),0,0)),l.push(new v(o+c.index,o+c.index+c[0].length,d))}}o=f}if(!n.validEnd){let h=n.fillBefore(m.empty,!0);r.replace(o,o,new g(h,0,0))}for(let h=l.length-1;h>=0;h--)r.step(l[h])}function ie(r,t,e){return(t==0||r.canReplace(t,r.childCount))&&(e==r.childCount||r.canReplace(0,e))}function Ce(r){let e=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth;;--n){let i=r.$from.node(n),s=r.$from.index(n),l=r.$to.indexAfter(n);if(n<r.depth&&i.canReplace(s,l,e))return n;if(n==0||i.type.spec.isolating||!ie(i,s,l))break}return null}function re(r,t,e){let{$from:n,$to:i,depth:s}=t,l=n.before(s+1),o=i.after(s+1),h=l,a=o,f=m.empty,u=0;for(let d=s,y=!1;d>e;d--)y||n.index(d)>0?(y=!0,f=m.from(n.node(d).copy(f)),u++):h--;let c=m.empty,p=0;for(let d=s,y=!1;d>e;d--)y||i.after(d+1)<i.end(d)?(y=!0,c=m.from(i.node(d).copy(c)),p++):a++;r.step(new C(h,a,l,o,new g(f.append(c),u,p),f.size-u,!0))}function be(r,t,e=null,n=r){let i=se(r,t),s=i&&le(n,t);return s?i.map(St).concat({type:t,attrs:e}).concat(s.map(St)):null}function St(r){return{type:r,attrs:null}}function se(r,t){let{parent:e,startIndex:n,endIndex:i}=r,s=e.contentMatchAt(n).findWrapping(t);if(!s)return null;let l=s.length?s[0]:t;return e.canReplaceWith(n,i,l)?s:null}function le(r,t){let{parent:e,startIndex:n,endIndex:i}=r,s=e.child(n),l=t.contentMatch.findWrapping(s.type);if(!l)return null;let h=(l.length?l[l.length-1]:t).contentMatch;for(let a=n;h&&a<i;a++)h=h.matchType(e.child(a).type);return!h||!h.validEnd?null:l}function oe(r,t,e){let n=m.empty;for(let l=e.length-1;l>=0;l--){if(n.size){let o=e[l].type.contentMatch.matchFragment(n);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=m.from(e[l].type.create(e[l].attrs,n))}let i=t.start,s=t.end;r.step(new C(i,s,i,s,new g(n,0,0),e.length,!0))}function he(r,t,e,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(t,e,(l,o)=>{if(l.isTextblock&&!l.hasMarkup(n,i)&&ce(r.doc,r.mapping.slice(s).map(o),n)){let h=null;if(n.schema.linebreakReplacement){let c=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);c&&!p?h=!1:!c&&p&&(h=!0)}h===!1&&fe(r,l,o,s),Tt(r,r.mapping.slice(s).map(o,1),n,void 0,h===null);let a=r.mapping.slice(s),f=a.map(o,1),u=a.map(o+l.nodeSize,1);return r.step(new C(f,u,f+1,u-1,new g(m.from(n.create(i,null,l.marks)),0,0),1,!0)),h===!0&&ae(r,l,o,s),!1}})}function ae(r,t,e,n){t.forEach((i,s)=>{if(i.isText){let l,o=/\r?\n|\r/g;for(;l=o.exec(i.text);){let h=r.mapping.slice(n).map(e+1+s+l.index);r.replaceWith(h,h+1,t.type.schema.linebreakReplacement.create())}}})}function fe(r,t,e,n){t.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let l=r.mapping.slice(n).map(e+1+s);r.replaceWith(l,l+1,t.type.schema.text(`
`))}})}function ce(r,t,e){let n=r.resolve(t),i=n.index();return n.parent.canReplaceWith(i,i+1,e)}function ue(r,t,e,n,i){let s=r.doc.nodeAt(t);if(!s)throw new RangeError("No node at given position");e||(e=s.type);let l=e.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(t,t+s.nodeSize,l);if(!e.validContent(s.content))throw new RangeError("Invalid content for node type "+e.name);r.step(new C(t,t+s.nodeSize,t+1,t+s.nodeSize-1,new g(m.from(l),0,0),1,!0))}function Me(r,t,e=1,n){let i=r.resolve(t),s=i.depth-e,l=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!l.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let a=i.depth-1,f=e-2;a>s;a--,f--){let u=i.node(a),c=i.index(a);if(u.type.spec.isolating)return!1;let p=u.content.cutByIndex(c,u.childCount),d=n&&n[f+1];d&&(p=p.replaceChild(0,d.type.create(d.attrs)));let y=n&&n[f]||u;if(!u.canReplace(c+1,u.childCount)||!y.type.validContent(p))return!1}let o=i.indexAfter(s),h=n&&n[0];return i.node(s).canReplaceWith(o,o,h?h.type:i.node(s+1).type)}function pe(r,t,e=1,n){let i=r.doc.resolve(t),s=m.empty,l=m.empty;for(let o=i.depth,h=i.depth-e,a=e-1;o>h;o--,a--){s=m.from(i.node(o).copy(s));let f=n&&n[a];l=m.from(f?f.type.create(f.attrs,l):i.node(o).copy(l))}r.step(new v(t,t,new g(s.append(l),e,e),!0))}function Oe(r,t){let e=r.resolve(t),n=e.index();return Nt(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(n,n+1)}function Nt(r,t){return!!(r&&t&&!r.isLeaf&&r.canAppend(t))}function Te(r,t,e=-1){let n=r.resolve(t);for(let i=n.depth;;i--){let s,l,o=n.index(i);if(i==n.depth?(s=n.nodeBefore,l=n.nodeAfter):e>0?(s=n.node(i+1),o++,l=n.node(i).maybeChild(o)):(s=n.node(i).maybeChild(o-1),l=n.node(i+1)),s&&!s.isTextblock&&Nt(s,l)&&n.node(i).canReplace(o,o+1))return t;if(i==0)break;t=e<0?n.before(i):n.after(i)}}function de(r,t,e){let n=new v(t-e,t+e,g.empty,!0);r.step(n)}function me(r,t,e){let n=r.resolve(t);if(n.parent.canReplaceWith(n.index(),n.index(),e))return t;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,e))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,e))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function Ne(r,t,e){let n=r.resolve(t);if(!e.content.size)return t;let i=e.content;for(let s=0;s<e.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(e.openStart==0&&e.size?2:1);s++)for(let l=n.depth;l>=0;l--){let o=l==n.depth?0:n.pos<=(n.start(l+1)+n.end(l+1))/2?-1:1,h=n.index(l)+(o>0?1:0),a=n.node(l),f=!1;if(s==1)f=a.canReplace(h,h,i);else{let u=a.contentMatchAt(h).findWrapping(i.firstChild.type);f=u&&a.canReplaceWith(h,h,u[0])}if(f)return o==0?n.pos:o<0?n.before(l+1):n.after(l+1)}return null}function ge(r,t,e=t,n=g.empty){if(t==e&&!n.size)return null;let i=r.resolve(t),s=r.resolve(e);return Rt(i,s,n)?new v(t,e,n):new st(i,s,n).fit()}function Rt(r,t,e){return!e.openStart&&!e.openEnd&&r.start()==t.start()&&r.parent.canReplace(r.index(),t.index(),e.content)}var st=class{constructor(t,e,n){this.$from=t,this.$to=e,this.unplaced=n,this.frontier=[],this.placed=m.empty;for(let i=0;i<=t.depth;i++){let s=t.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(t.indexAfter(i))})}for(let i=t.depth;i>0;i--)this.placed=m.from(t.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let a=this.findFittable();a?this.placeNodes(a):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(t<0?this.$to:n.doc.resolve(t));if(!i)return null;let s=this.placed,l=n.depth,o=i.depth;for(;l&&o&&s.childCount==1;)s=s.firstChild.content,l--,o--;let h=new g(s,l,o);return t>-1?new C(n.pos,t,this.$to.pos,this.$to.end(),h,e):h.size||n.pos!=this.$to.pos?new v(n.pos,i.pos,h):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,n=0,i=this.unplaced.openEnd;n<t;n++){let s=e.firstChild;if(e.childCount>1&&(i=0),s.type.spec.isolating&&i<=n){t=n;break}e=s.content}for(let e=1;e<=2;e++)for(let n=e==1?t:this.unplaced.openStart;n>=0;n--){let i,s=null;n?(s=et(this.unplaced.content,n-1).firstChild,i=s.content):i=this.unplaced.content;let l=i.firstChild;for(let o=this.depth;o>=0;o--){let{type:h,match:a}=this.frontier[o],f,u=null;if(e==1&&(l?a.matchType(l.type)||(u=a.fillBefore(m.from(l),!1)):s&&h.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:o,parent:s,inject:u};if(e==2&&l&&(f=a.findWrapping(l.type)))return{sliceDepth:n,frontierDepth:o,parent:s,wrap:f};if(s&&a.matchType(s.type))break}}}openMore(){let{content:t,openStart:e,openEnd:n}=this.unplaced,i=et(t,e);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new g(t,e+1,Math.max(n,i.size+e>=t.size-n?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:n}=this.unplaced,i=et(t,e);if(i.childCount<=1&&e>0){let s=t.size-e<=e+i.size;this.unplaced=new g(A(t,e-1,1),e-1,s?e-1:n)}else this.unplaced=new g(A(t,e,1),e,n)}placeNodes({sliceDepth:t,frontierDepth:e,parent:n,inject:i,wrap:s}){for(;this.depth>e;)this.closeFrontierNode();if(s)for(let y=0;y<s.length;y++)this.openFrontierNode(s[y]);let l=this.unplaced,o=n?n.content:l.content,h=l.openStart-t,a=0,f=[],{match:u,type:c}=this.frontier[e];if(i){for(let y=0;y<i.childCount;y++)f.push(i.child(y));u=u.matchFragment(i)}let p=o.size+t-(l.content.size-l.openEnd);for(;a<o.childCount;){let y=o.child(a),k=u.matchType(y.type);if(!k)break;a++,(a>1||h==0||y.content.size)&&(u=k,f.push(It(y.mark(c.allowedMarks(y.marks)),a==1?h:0,a==o.childCount?p:-1)))}let d=a==o.childCount;d||(p=-1),this.placed=F(this.placed,e,m.from(f)),this.frontier[e].match=u,d&&p<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let y=0,k=o;y<p;y++){let b=k.lastChild;this.frontier.push({type:b.type,match:b.contentMatchAt(b.childCount)}),k=b.content}this.unplaced=d?t==0?g.empty:new g(A(l.content,t-1,1),t-1,p<0?l.openEnd:t-1):new g(A(l.content,t,a),l.openStart,l.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],e;if(!t.type.isTextblock||!nt(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:n,type:i}=this.frontier[e],s=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),l=nt(t,e,i,n,s);if(l){for(let o=e-1;o>=0;o--){let{match:h,type:a}=this.frontier[o],f=nt(t,o,a,h,!0);if(!f||f.childCount)continue t}return{depth:e,fit:l,move:s?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=F(this.placed,e.depth,e.fit)),t=e.move;for(let n=e.depth+1;n<=t.depth;n++){let i=t.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,t.index(n));this.openFrontierNode(i.type,i.attrs,s)}return t}openFrontierNode(t,e=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(t),this.placed=F(this.placed,this.depth,m.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(m.empty,!0);e.childCount&&(this.placed=F(this.placed,this.frontier.length,e))}};function A(r,t,e){return t==0?r.cutByIndex(e,r.childCount):r.replaceChild(0,r.firstChild.copy(A(r.firstChild.content,t-1,e)))}function F(r,t,e){return t==0?r.append(e):r.replaceChild(r.childCount-1,r.lastChild.copy(F(r.lastChild.content,t-1,e)))}function et(r,t){for(let e=0;e<t;e++)r=r.firstChild.content;return r}function It(r,t,e){if(t<=0)return r;let n=r.content;return t>1&&(n=n.replaceChild(0,It(n.firstChild,t-1,n.childCount==1?e-1:0))),t>0&&(n=r.type.contentMatch.fillBefore(n).append(n),e<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(m.empty,!0)))),r.copy(n)}function nt(r,t,e,n,i){let s=r.node(t),l=i?r.indexAfter(t):r.index(t);if(l==s.childCount&&!e.compatibleContent(s.type))return null;let o=n.fillBefore(s.content,!0,l);return o&&!ye(e,s.content,l)?o:null}function ye(r,t,e){for(let n=e;n<t.childCount;n++)if(!r.allowsMarks(t.child(n).marks))return!0;return!1}function xe(r){return r.spec.defining||r.spec.definingForContent}function we(r,t,e,n){if(!n.size)return r.deleteRange(t,e);let i=r.doc.resolve(t),s=r.doc.resolve(e);if(Rt(i,s,n))return r.step(new v(t,e,n));let l=At(i,r.doc.resolve(e));l[l.length-1]==0&&l.pop();let o=-(i.depth+1);l.unshift(o);for(let c=i.depth,p=i.pos-1;c>0;c--,p--){let d=i.node(c).type.spec;if(d.defining||d.definingAsContext||d.isolating)break;l.indexOf(c)>-1?o=c:i.before(c)==p&&l.splice(1,0,-c)}let h=l.indexOf(o),a=[],f=n.openStart;for(let c=n.content,p=0;;p++){let d=c.firstChild;if(a.push(d),p==n.openStart)break;c=d.content}for(let c=f-1;c>=0;c--){let p=a[c],d=xe(p.type);if(d&&!p.sameMarkup(i.node(Math.abs(o)-1)))f=c;else if(d||!p.type.isTextblock)break}for(let c=n.openStart;c>=0;c--){let p=(c+f+1)%(n.openStart+1),d=a[p];if(d)for(let y=0;y<l.length;y++){let k=l[(y+h)%l.length],b=!0;k<0&&(b=!1,k=-k);let Ft=i.node(k-1),ot=i.index(k-1);if(Ft.canReplaceWith(ot,ot,d.type,d.marks))return r.replace(i.before(k),b?s.after(k):e,new g(zt(n.content,0,n.openStart,p),p,n.openEnd))}}let u=r.steps.length;for(let c=l.length-1;c>=0&&(r.replace(t,e,n),!(r.steps.length>u));c--){let p=l[c];p<0||(t=i.before(p),e=s.after(p))}}function zt(r,t,e,n,i){if(t<e){let s=r.firstChild;r=r.replaceChild(0,s.copy(zt(s.content,t+1,e,n,s)))}if(t>n){let s=i.contentMatchAt(0),l=s.fillBefore(r).append(r);r=l.append(s.matchFragment(l).fillBefore(m.empty,!0))}return r}function ke(r,t,e,n){if(!n.isInline&&t==e&&r.doc.resolve(t).parent.content.size){let i=me(r.doc,t,n.type);i!=null&&(t=e=i)}r.replaceRange(t,e,new g(m.from(n),0,0))}function Se(r,t,e){let n=r.doc.resolve(t),i=r.doc.resolve(e),s=At(n,i);for(let l=0;l<s.length;l++){let o=s[l],h=l==s.length-1;if(h&&o==0||n.node(o).type.contentMatch.validEnd)return r.delete(n.start(o),i.end(o));if(o>0&&(h||n.node(o-1).canReplace(n.index(o-1),i.indexAfter(o-1))))return r.delete(n.before(o),i.after(o))}for(let l=1;l<=n.depth&&l<=i.depth;l++)if(t-n.start(l)==n.depth-l&&e>n.end(l)&&i.end(l)-e!=i.depth-l)return r.delete(n.before(l),e);r.delete(t,e)}function At(r,t){let e=[],n=Math.min(r.depth,t.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||t.end(i)>t.pos+(t.depth-i)||r.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(s==t.start(i)||i==r.depth&&i==t.depth&&r.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==s-1)&&e.push(i)}return e}var H=class r extends x{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return w.fail("No node at attribute step's position");let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let i=e.type.create(n,null,e.marks);return w.fromReplace(t,this.pos,this.pos+1,new g(m.from(i),0,e.isLeaf?0:1))}getMap(){return E.empty}invert(t){return new r(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new r(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.pos!="number"||typeof e.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new r(e.pos,e.attr,e.value)}};x.jsonID("attr",H);var j=class r extends x{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let i in t.attrs)e[i]=t.attrs[i];e[this.attr]=this.value;let n=t.type.create(e,t.content,t.marks);return w.ok(n)}getMap(){return E.empty}invert(t){return new r(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new r(e.attr,e.value)}};x.jsonID("docAttr",j);var R=class extends Error{};R=function r(t){let e=Error.call(this,t);return e.__proto__=r.prototype,e};R.prototype=Object.create(Error.prototype);R.prototype.constructor=R;R.prototype.name="TransformError";var vt=class{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new it}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new R(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,n=g.empty){let i=ge(this.doc,t,e,n);return i&&this.step(i),this}replaceWith(t,e,n){return this.replace(t,e,new g(m.from(n),0,0))}delete(t,e){return this.replace(t,e,g.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,n){return we(this,t,e,n),this}replaceRangeWith(t,e,n){return ke(this,t,e,n),this}deleteRange(t,e){return Se(this,t,e),this}lift(t,e){return re(this,t,e),this}join(t,e=1){return de(this,t,e),this}wrap(t,e){return oe(this,t,e),this}setBlockType(t,e=t,n,i=null){return he(this,t,e,n,i),this}setNodeMarkup(t,e,n=null,i){return ue(this,t,e,n,i),this}setNodeAttribute(t,e,n){return this.step(new H(t,e,n)),this}setDocAttribute(t,e){return this.step(new j(t,e)),this}addNodeMark(t,e){return this.step(new D(t,e)),this}removeNodeMark(t,e){if(!(e instanceof S)){let n=this.doc.nodeAt(t);if(!n)throw new RangeError("No node at position "+t);if(e=e.isInSet(n.marks),!e)return this}return this.step(new W(t,e)),this}split(t,e=1,n){return pe(this,t,e,n),this}addMark(t,e,n){return ee(this,t,e,n),this}removeMark(t,e,n){return ne(this,t,e,n),this}clearIncompatible(t,e,n){return Tt(this,t,e,n),this}};export{B as AddMarkStep,D as AddNodeMarkStep,H as AttrStep,j as DocAttrStep,J as MapResult,it as Mapping,N as RemoveMarkStep,W as RemoveNodeMarkStep,C as ReplaceAroundStep,v as ReplaceStep,x as Step,E as StepMap,w as StepResult,vt as Transform,R as TransformError,Oe as canJoin,Me as canSplit,Ne as dropPoint,be as findWrapping,me as insertPoint,Te as joinPoint,Ce as liftTarget,ge as replaceStep};
//# sourceMappingURL=prosemirror-transform.bundle.mjs.map