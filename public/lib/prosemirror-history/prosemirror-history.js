/* esm.sh - prosemirror-history@1.4.1 */
var G=200,w=function(){};w.prototype.append=function(e){return e.length?(e=w.from(e),!this.length&&e||e.length<G&&this.leafAppend(e)||this.length<G&&e.leafPrepend(this)||this.appendInner(e)):this};w.prototype.prepend=function(e){return e.length?w.from(e).append(this):this};w.prototype.appendInner=function(e){return new Ye(this,e)};w.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?w.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};w.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};w.prototype.forEach=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)};w.prototype.map=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length);var r=[];return this.forEach(function(s,l){return r.push(e(s,l))},t,n),r};w.from=function(e){return e instanceof w?e:e&&e.length?new Me(e):w.empty};var Me=(function(i){function e(n){i.call(this),this.values=n}i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(r,s){return r==0&&s==this.length?this:new e(this.values.slice(r,s))},e.prototype.getInner=function(r){return this.values[r]},e.prototype.forEachInner=function(r,s,l,o){for(var a=s;a<l;a++)if(r(this.values[a],o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,l,o){for(var a=s-1;a>=l;a--)if(r(this.values[a],o+a)===!1)return!1},e.prototype.leafAppend=function(r){if(this.length+r.length<=G)return new e(this.values.concat(r.flatten()))},e.prototype.leafPrepend=function(r){if(this.length+r.length<=G)return new e(r.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e})(w);w.empty=new Me([]);var Ye=(function(i){function e(t,n){i.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,r,s,l){var o=this.left.length;if(r<o&&this.left.forEachInner(n,r,Math.min(s,o),l)===!1||s>o&&this.right.forEachInner(n,Math.max(r-o,0),Math.min(this.length,s)-o,l+o)===!1)return!1},e.prototype.forEachInvertedInner=function(n,r,s,l){var o=this.left.length;if(r>o&&this.right.forEachInvertedInner(n,r-o,Math.max(s,o)-o,l+o)===!1||s<o&&this.left.forEachInvertedInner(n,Math.min(r,o),s,l)===!1)return!1},e.prototype.sliceInner=function(n,r){if(n==0&&r==this.length)return this;var s=this.left.length;return r<=s?this.left.slice(n,r):n>=s?this.right.slice(n-s,r-s):this.left.slice(n,s).append(this.right.slice(0,r-s))},e.prototype.leafAppend=function(n){var r=this.right.leafAppend(n);if(r)return new e(this.left,r)},e.prototype.leafPrepend=function(n){var r=this.left.leafPrepend(n);if(r)return new e(r,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e})(w),se=w;function Oe(i,e,t){for(let n=0;;n++){if(n==i.childCount||n==e.childCount)return i.childCount==e.childCount?null:t;let r=i.child(n),s=e.child(n);if(r==s){t+=r.nodeSize;continue}if(!r.sameMarkup(s))return t;if(r.isText&&r.text!=s.text){for(let l=0;r.text[l]==s.text[l];l++)t++;return t}if(r.content.size||s.content.size){let l=Oe(r.content,s.content,t+1);if(l!=null)return l}t+=r.nodeSize}}function Ie(i,e,t,n){for(let r=i.childCount,s=e.childCount;;){if(r==0||s==0)return r==s?null:{a:t,b:n};let l=i.child(--r),o=e.child(--s),a=l.nodeSize;if(l==o){t-=a,n-=a;continue}if(!l.sameMarkup(o))return{a:t,b:n};if(l.isText&&l.text!=o.text){let h=0,f=Math.min(l.text.length,o.text.length);for(;h<f&&l.text[l.text.length-h-1]==o.text[o.text.length-h-1];)h++,t--,n--;return{a:t,b:n}}if(l.content.size||o.content.size){let h=Ie(l.content,o.content,t-1,n-1);if(h)return h}t-=a,n-=a}}var d=class i{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,r=0,s){for(let l=0,o=0;o<t;l++){let a=this.content[l],h=o+a.nodeSize;if(h>e&&n(a,r+o,s||null,l)!==!1&&a.content.size){let f=o+1;a.nodesBetween(Math.max(0,e-f),Math.min(a.content.size,t-f),n,r+f)}o=h}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,r){let s="",l=!0;return this.nodesBetween(e,t,(o,a)=>{let h=o.isText?o.text.slice(Math.max(e,a)-a,t-a):o.isLeaf?r?typeof r=="function"?r(o):r:o.type.spec.leafText?o.type.spec.leafText(o):"":"";o.isBlock&&(o.isLeaf&&h||o.isTextblock)&&n&&(l?l=!1:s+=n),s+=h},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,r=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(r[r.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)r.push(e.content[s]);return new i(r,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],r=0;if(t>e)for(let s=0,l=0;l<t;s++){let o=this.content[s],a=l+o.nodeSize;a>e&&((l<e||a>t)&&(o.isText?o=o.cut(Math.max(0,e-l),Math.min(o.text.length,t-l)):o=o.cut(Math.max(0,e-l-1),Math.min(o.content.size,t-l-1))),n.push(o),r+=o.nodeSize),l=a}return new i(n,r)}cutByIndex(e,t){return e==t?i.empty:e==0&&t==this.content.length?this:new i(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let r=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return r[e]=t,new i(r,s)}addToStart(e){return new i([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new i(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let r=this.content[t];e(r,n,t),n+=r.nodeSize}}findDiffStart(e,t=0){return Oe(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return Ie(this,e,t,n)}findIndex(e){if(e==0)return V(0,e);if(e==this.size)return V(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let r=this.child(t),s=n+r.nodeSize;if(s>=e)return s==e?V(t+1,s):V(t,n);n=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return i.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new i(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return i.empty;let t,n=0;for(let r=0;r<e.length;r++){let s=e[r];n+=s.nodeSize,r&&s.isText&&e[r-1].sameMarkup(s)?(t||(t=e.slice(0,r)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new i(t||e,n)}static from(e){if(!e)return i.empty;if(e instanceof i)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new i([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};d.empty=new d([],0);var le={index:0,offset:0};function V(i,e){return le.index=i,le.offset=e,le}function H(i,e){if(i===e)return!0;if(!(i&&typeof i=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(i);if(Array.isArray(e)!=t)return!1;if(t){if(i.length!=e.length)return!1;for(let n=0;n<i.length;n++)if(!H(i[n],e[n]))return!1}else{for(let n in i)if(!(n in e)||!H(i[n],e[n]))return!1;for(let n in e)if(!(n in i))return!1}return!0}var k=class i{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let r=0;r<e.length;r++){let s=e[r];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,r));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,r)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&H(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let r=n.create(t.attrs);return n.checkAttrs(r.attrs),r}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return i.none;if(e instanceof i)return[e];let t=e.slice();return t.sort((n,r)=>n.type.rank-r.type.rank),t}};k.none=[];var T=class extends Error{},c=class i{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=Ne(this.content,e+this.openStart,t);return n&&new i(n,this.openStart,this.openEnd)}removeBetween(e,t){return new i(Te(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return i.empty;let n=t.openStart||0,r=t.openEnd||0;if(typeof n!="number"||typeof r!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new i(d.fromJSON(e,t.content),n,r)}static maxOpen(e,t=!0){let n=0,r=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)r++;return new i(e,n,r)}};c.empty=new c(d.empty,0,0);function Te(i,e,t){let{index:n,offset:r}=i.findIndex(e),s=i.maybeChild(n),{index:l,offset:o}=i.findIndex(t);if(r==e||s.isText){if(o!=t&&!i.child(l).isText)throw new RangeError("Removing non-flat range");return i.cut(0,e).append(i.cut(t))}if(n!=l)throw new RangeError("Removing non-flat range");return i.replaceChild(n,s.copy(Te(s.content,e-r-1,t-r-1)))}function Ne(i,e,t,n){let{index:r,offset:s}=i.findIndex(e),l=i.maybeChild(r);if(s==e||l.isText)return n&&!n.canReplace(r,r,t)?null:i.cut(0,e).append(t).append(i.cut(e));let o=Ne(l.content,e-s-1,t,l);return o&&i.replaceChild(r,l.copy(o))}function $e(i,e,t){if(t.openStart>i.depth)throw new T("Inserted content deeper than insertion position");if(i.depth-t.openStart!=e.depth-t.openEnd)throw new T("Inconsistent open depths");return Re(i,e,t,0)}function Re(i,e,t,n){let r=i.index(n),s=i.node(n);if(r==e.index(n)&&n<i.depth-t.openStart){let l=Re(i,e,t,n+1);return s.copy(s.content.replaceChild(r,l))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&i.depth==n&&e.depth==n){let l=i.parent,o=l.content;return I(l,o.cut(0,i.parentOffset).append(t.content).append(o.cut(e.parentOffset)))}else{let{start:l,end:o}=_e(t,i);return I(s,ze(i,l,o,e,n))}else return I(s,K(i,e,n))}function Ae(i,e){if(!e.type.compatibleContent(i.type))throw new T("Cannot join "+e.type.name+" onto "+i.type.name)}function oe(i,e,t){let n=i.node(t);return Ae(n,e.node(t)),n}function O(i,e){let t=e.length-1;t>=0&&i.isText&&i.sameMarkup(e[t])?e[t]=i.withText(e[t].text+i.text):e.push(i)}function J(i,e,t,n){let r=(e||i).node(t),s=0,l=e?e.index(t):r.childCount;i&&(s=i.index(t),i.depth>t?s++:i.textOffset&&(O(i.nodeAfter,n),s++));for(let o=s;o<l;o++)O(r.child(o),n);e&&e.depth==t&&e.textOffset&&O(e.nodeBefore,n)}function I(i,e){return i.type.checkContent(e),i.copy(e)}function ze(i,e,t,n,r){let s=i.depth>r&&oe(i,e,r+1),l=n.depth>r&&oe(t,n,r+1),o=[];return J(null,i,r,o),s&&l&&e.index(r)==t.index(r)?(Ae(s,l),O(I(s,ze(i,e,t,n,r+1)),o)):(s&&O(I(s,K(i,e,r+1)),o),J(e,t,r,o),l&&O(I(l,K(t,n,r+1)),o)),J(n,null,r,o),new d(o)}function K(i,e,t){let n=[];if(J(null,i,t,n),i.depth>t){let r=oe(i,e,t+1);O(I(r,K(i,e,t+1)),n)}return J(e,null,t,n),new d(n)}function _e(i,e){let t=e.depth-i.openStart,r=e.node(t).copy(i.content);for(let s=t-1;s>=0;s--)r=e.node(s).copy(d.from(r));return{start:r.resolveNoCache(i.openStart+t),end:r.resolveNoCache(r.content.size-i.openEnd-t)}}var j=class i{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=e.child(t);return n?e.child(t).cut(n):r}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],r=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)r+=n.child(s).nodeSize;return r}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return k.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),r=e.maybeChild(t);if(!n){let o=n;n=r,r=o}let s=n.marks;for(var l=0;l<s.length;l++)s[l].type.spec.inclusive===!1&&(!r||!s[l].isInSet(r.marks))&&(s=s[l--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,r=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!r||!n[s].isInSet(r.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new he(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],r=0,s=t;for(let l=e;;){let{index:o,offset:a}=l.content.findIndex(s),h=s-a;if(n.push(l,o,r+a),!h||(l=l.child(o),l.isText))break;s=h-1,r+=a+1}return new i(t,n,s)}static resolveCached(e,t){let n=Ee.get(e);if(n)for(let s=0;s<n.elts.length;s++){let l=n.elts[s];if(l.pos==t)return l}else Ee.set(e,n=new ae);let r=n.elts[n.i]=i.resolve(e,t);return n.i=(n.i+1)%et,r}},ae=class{constructor(){this.elts=[],this.i=0}},et=12,Ee=new WeakMap,he=class{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},tt=Object.create(null),Z=class i{constructor(e,t,n,r=k.none){this.type=e,this.attrs=t,this.marks=r,this.content=n||d.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,r=0){this.content.nodesBetween(e,t,n,r,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,r){return this.content.textBetween(e,t,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&H(this.attrs,t||e.defaultAttrs||tt)&&k.sameSet(this.marks,n||k.none)}copy(e=null){return e==this.content?this:new i(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new i(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return c.empty;let r=this.resolve(e),s=this.resolve(t),l=n?0:r.sharedDepth(t),o=r.start(l),h=r.node(l).content.cut(r.pos-o,s.pos-o);return new c(h,r.depth-l,s.depth-l)}replace(e,t,n){return $e(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:r}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(r==e||t.isText)return t;e-=r+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let r=this.content.child(t-1);return{node:r,index:t-1,offset:n-r.nodeSize}}resolve(e){return j.resolveCached(this,e)}resolveNoCache(e){return j.resolve(this,e)}rangeHasMark(e,t,n){let r=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),nt(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=d.empty,r=0,s=n.childCount){let l=this.contentMatchAt(e).matchFragment(n,r,s),o=l&&l.matchFragment(this.content,t);if(!o||!o.validEnd)return!1;for(let a=r;a<s;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}canReplaceWith(e,t,n,r){if(r&&!this.type.allowsMarks(r))return!1;let s=this.contentMatchAt(e).matchType(n),l=s&&s.matchFragment(this.content,t);return l?l.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=k.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!k.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let r=d.fromJSON(e,t.content),s=e.nodeType(t.type).create(t.attrs,r,n);return s.type.checkAttrs(s.attrs),s}};Z.prototype.text=void 0;function nt(i,e){for(let t=i.length-1;t>=0;t--)e=i[t].type.name+"("+e+")";return e}var D=class i{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new fe(e,t);if(n.next==null)return i.empty;let r=Fe(n);n.next&&n.err("Unexpected trailing text");let s=ht(at(r));return ft(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let r=this;for(let s=t;r&&s<n;s++)r=r.matchType(e.child(s).type);return r}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let r=[this];function s(l,o){let a=l.matchFragment(e,n);if(a&&(!t||a.validEnd))return d.from(o.map(h=>h.createAndFill()));for(let h=0;h<l.next.length;h++){let{type:f,next:p}=l.next[h];if(!(f.isText||f.hasRequiredAttrs())&&r.indexOf(p)==-1){r.push(p);let u=s(p,o.concat(f));if(u)return u}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),s=r.match;if(s.matchType(e)){let l=[];for(let o=r;o.type;o=o.via)l.push(o.type);return l.reverse()}for(let l=0;l<s.next.length;l++){let{type:o,next:a}=s.next[l];!o.isLeaf&&!o.hasRequiredAttrs()&&!(o.name in t)&&(!r.type||a.validEnd)&&(n.push({match:o.contentMatch,type:o,via:r}),t[o.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let r=0;r<n.next.length;r++)e.indexOf(n.next[r].next)==-1&&t(n.next[r].next)}return t(this),e.map((n,r)=>{let s=r+(n.validEnd?"*":" ")+" ";for(let l=0;l<n.next.length;l++)s+=(l?", ":"")+n.next[l].type.name+"->"+e.indexOf(n.next[l].next);return s}).join(`
`)}};D.empty=new D(!0);var fe=class{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function Fe(i){let e=[];do e.push(it(i));while(i.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function it(i){let e=[];do e.push(rt(i));while(i.next&&i.next!=")"&&i.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function rt(i){let e=ot(i);for(;;)if(i.eat("+"))e={type:"plus",expr:e};else if(i.eat("*"))e={type:"star",expr:e};else if(i.eat("?"))e={type:"opt",expr:e};else if(i.eat("{"))e=st(i,e);else break;return e}function Ce(i){/\D/.test(i.next)&&i.err("Expected number, got '"+i.next+"'");let e=Number(i.next);return i.pos++,e}function st(i,e){let t=Ce(i),n=t;return i.eat(",")&&(i.next!="}"?n=Ce(i):n=-1),i.eat("}")||i.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function lt(i,e){let t=i.nodeTypes,n=t[e];if(n)return[n];let r=[];for(let s in t){let l=t[s];l.isInGroup(e)&&r.push(l)}return r.length==0&&i.err("No node type or group '"+e+"' found"),r}function ot(i){if(i.eat("(")){let e=Fe(i);return i.eat(")")||i.err("Missing closing paren"),e}else if(/\W/.test(i.next))i.err("Unexpected token '"+i.next+"'");else{let e=lt(i,i.next).map(t=>(i.inline==null?i.inline=t.isInline:i.inline!=t.isInline&&i.err("Mixing inline and block content"),{type:"name",value:t}));return i.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function at(i){let e=[[]];return r(s(i,0),t()),e;function t(){return e.push([])-1}function n(l,o,a){let h={term:a,to:o};return e[l].push(h),h}function r(l,o){l.forEach(a=>a.to=o)}function s(l,o){if(l.type=="choice")return l.exprs.reduce((a,h)=>a.concat(s(h,o)),[]);if(l.type=="seq")for(let a=0;;a++){let h=s(l.exprs[a],o);if(a==l.exprs.length-1)return h;r(h,o=t())}else if(l.type=="star"){let a=t();return n(o,a),r(s(l.expr,a),a),[n(a)]}else if(l.type=="plus"){let a=t();return r(s(l.expr,o),a),r(s(l.expr,a),a),[n(a)]}else{if(l.type=="opt")return[n(o)].concat(s(l.expr,o));if(l.type=="range"){let a=o;for(let h=0;h<l.min;h++){let f=t();r(s(l.expr,a),f),a=f}if(l.max==-1)r(s(l.expr,a),a);else for(let h=l.min;h<l.max;h++){let f=t();n(a,f),r(s(l.expr,a),f),a=f}return[n(a)]}else{if(l.type=="name")return[n(o,void 0,l.value)];throw new Error("Unknown expr type")}}}}function Je(i,e){return e-i}function be(i,e){let t=[];return n(e),t.sort(Je);function n(r){let s=i[r];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(r);for(let l=0;l<s.length;l++){let{term:o,to:a}=s[l];!o&&t.indexOf(a)==-1&&n(a)}}}function ht(i){let e=Object.create(null);return t(be(i,0));function t(n){let r=[];n.forEach(l=>{i[l].forEach(({term:o,to:a})=>{if(!o)return;let h;for(let f=0;f<r.length;f++)r[f][0]==o&&(h=r[f][1]);be(i,a).forEach(f=>{h||r.push([o,h=[]]),h.indexOf(f)==-1&&h.push(f)})})});let s=e[n.join(",")]=new D(n.indexOf(i.length-1)>-1);for(let l=0;l<r.length;l++){let o=r[l][1].sort(Je);s.next.push({type:r[l][0],next:e[o.join(",")]||t(o)})}return s}}function ft(i,e){for(let t=0,n=[i];t<n.length;t++){let r=n[t],s=!r.validEnd,l=[];for(let o=0;o<r.next.length;o++){let{type:a,next:h}=r.next[o];l.push(a.name),s&&!(a.isText||a.hasRequiredAttrs())&&(s=!1),n.indexOf(h)==-1&&n.push(h)}s&&e.err("Only non-generatable nodes ("+l.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}var Be=65535,Pe=Math.pow(2,16);function pt(i,e){return i+e*Pe}function De(i){return i&Be}function ct(i){return(i-(i&Be))/Pe}var We=1,Le=2,Q=4,qe=8,B=class{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&qe)>0}get deletedBefore(){return(this.delInfo&(We|Q))>0}get deletedAfter(){return(this.delInfo&(Le|Q))>0}get deletedAcross(){return(this.delInfo&Q)>0}},E=class i{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&i.empty)return i.empty}recover(e){let t=0,n=De(e);if(!this.inverted)for(let r=0;r<n;r++)t+=this.ranges[r*3+2]-this.ranges[r*3+1];return this.ranges[n*3]+t+ct(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let r=0,s=this.inverted?2:1,l=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?r:0);if(a>e)break;let h=this.ranges[o+s],f=this.ranges[o+l],p=a+h;if(e<=p){let u=h?e==a?-1:e==p?1:t:t,g=a+r+(u<0?0:f);if(n)return g;let M=e==(t<0?a:p)?null:pt(o/3,e-a),U=e==a?Le:e==p?We:Q;return(t<0?e!=a:e!=p)&&(U|=qe),new B(g,U,M)}r+=f-h}return n?e+r:new B(e+r,0,null)}touches(e,t){let n=0,r=De(t),s=this.inverted?2:1,l=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?n:0);if(a>e)break;let h=this.ranges[o+s],f=a+h;if(e<=f&&o==r*3)return!0;n+=this.ranges[o+l]-h}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,s=0;r<this.ranges.length;r+=3){let l=this.ranges[r],o=l-(this.inverted?s:0),a=l+(this.inverted?0:s),h=this.ranges[r+t],f=this.ranges[r+n];e(o,o+h,a,a+f),s+=f-h}}invert(){return new i(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?i.empty:new i(e<0?[0,-e,0]:[0,0,e])}};E.empty=new E([]);var X=class i{constructor(e,t,n=0,r=e?e.length:0){this.mirror=t,this.from=n,this.to=r,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new i(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let r=e.getMirror(t);this.appendMap(e._maps[t],r!=null&&r<t?n+r:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let r=e.getMirror(t);this.appendMap(e._maps[t].invert(),r!=null&&r>t?n-r-1:void 0)}}invert(){let e=new i;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let r=0;for(let s=this.from;s<this.to;s++){let l=this._maps[s],o=l.mapResult(e,t);if(o.recover!=null){let a=this.getMirror(s);if(a!=null&&a>s&&a<this.to){s=a,e=this._maps[a].recover(o.recover);continue}}r|=o.delInfo,e=o.pos}return n?e:new B(e,r,null)}},pe=Object.create(null),y=class{getMap(){return E.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=pe[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in pe)throw new RangeError("Duplicate use of step JSON ID "+e);return pe[e]=t,t.prototype.jsonID=e,t}},x=class i{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new i(e,null)}static fail(e){return new i(null,e)}static fromReplace(e,t,n,r){try{return i.ok(e.replace(t,n,r))}catch(s){if(s instanceof T)return i.fail(s.message);throw s}}};function me(i,e,t){let n=[];for(let r=0;r<i.childCount;r++){let s=i.child(r);s.content.size&&(s=s.copy(me(s.content,e,s))),s.isInline&&(s=e(s,t,r)),n.push(s)}return d.fromArray(n)}var Y=class i extends y{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),r=n.node(n.sharedDepth(this.to)),s=new c(me(t.content,(l,o)=>!l.isAtom||!o.type.allowsMarkType(this.mark.type)?l:l.mark(this.mark.addToSet(l.marks)),r),t.openStart,t.openEnd);return x.fromReplace(e,this.from,this.to,s)}invert(){return new $(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new i(t.pos,n.pos,this.mark)}merge(e){return e instanceof i&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new i(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new i(t.from,t.to,e.markFromJSON(t.mark))}};y.jsonID("addMark",Y);var $=class i extends y{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new c(me(t.content,r=>r.mark(this.mark.removeFromSet(r.marks)),e),t.openStart,t.openEnd);return x.fromReplace(e,this.from,this.to,n)}invert(){return new Y(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new i(t.pos,n.pos,this.mark)}merge(e){return e instanceof i&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new i(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new i(t.from,t.to,e.markFromJSON(t.mark))}};y.jsonID("removeMark",$);var _=class i extends y{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return x.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return x.fromReplace(e,this.pos,this.pos+1,new c(d.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let r=0;r<t.marks.length;r++)if(!t.marks[r].isInSet(n))return new i(this.pos,t.marks[r]);return new i(this.pos,this.mark)}}return new ee(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new i(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new i(t.pos,e.markFromJSON(t.mark))}};y.jsonID("addNodeMark",_);var ee=class i extends y{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return x.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return x.fromReplace(e,this.pos,this.pos+1,new c(d.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new _(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new i(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new i(t.pos,e.markFromJSON(t.mark))}};y.jsonID("removeNodeMark",ee);var P=class i extends y{constructor(e,t,n,r=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=r}apply(e){return this.structure&&ce(e,this.from,this.to)?x.fail("Structure replace would overwrite content"):x.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new E([this.from,this.to-this.from,this.slice.size])}invert(e){return new i(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new i(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof i)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?c.empty:new c(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new i(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?c.empty:new c(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new i(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new i(t.from,t.to,c.fromJSON(e,t.slice),!!t.structure)}};y.jsonID("replace",P);var W=class i extends y{constructor(e,t,n,r,s,l,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=r,this.slice=s,this.insert=l,this.structure=o}apply(e){if(this.structure&&(ce(e,this.from,this.gapFrom)||ce(e,this.gapTo,this.to)))return x.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return x.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?x.fromReplace(e,this.from,this.to,n):x.fail("Content does not fit in gap")}getMap(){return new E([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new i(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),r=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||r<t.pos||s>n.pos?null:new i(t.pos,n.pos,r,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new i(t.from,t.to,t.gapFrom,t.gapTo,c.fromJSON(e,t.slice),t.insert,!!t.structure)}};y.jsonID("replaceAround",W);function ce(i,e,t){let n=i.resolve(e),r=t-e,s=n.depth;for(;r>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,r--;if(r>0){let l=n.node(s).maybeChild(n.indexAfter(s));for(;r>0;){if(!l||l.isLeaf)return!0;l=l.firstChild,r--}}return!1}var ue=class i extends y{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return x.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let r=t.type.create(n,null,t.marks);return x.fromReplace(e,this.pos,this.pos+1,new c(d.from(r),0,t.isLeaf?0:1))}getMap(){return E.empty}invert(e){return new i(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new i(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new i(t.pos,t.attr,t.value)}};y.jsonID("attr",ue);var de=class i extends y{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let r in e.attrs)t[r]=e.attrs[r];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return x.ok(n)}getMap(){return E.empty}invert(e){return new i(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new i(t.attr,t.value)}};y.jsonID("docAttr",de);var L=class extends Error{};L=function i(e){let t=Error.call(this,e);return t.__proto__=i.prototype,t};L.prototype=Object.create(Error.prototype);L.prototype.constructor=L;L.prototype.name="TransformError";var ge=Object.create(null),m=class{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new we(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=c.empty){let n=t.content.lastChild,r=null;for(let o=0;o<t.openEnd;o++)r=n,n=n.lastChild;let s=e.steps.length,l=this.ranges;for(let o=0;o<l.length;o++){let{$from:a,$to:h}=l[o],f=e.mapping.slice(s);e.replaceRange(f.map(a.pos),f.map(h.pos),o?c.empty:t),o==0&&Ve(e,s,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let s=0;s<r.length;s++){let{$from:l,$to:o}=r[s],a=e.mapping.slice(n),h=a.map(l.pos),f=a.map(o.pos);s?e.deleteRange(h,f):(e.replaceRangeWith(h,f,t),Ve(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new R(e):z(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let s=e.depth-1;s>=0;s--){let l=t<0?z(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):z(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(l)return l}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new N(e.node(0))}static atStart(e){return z(e,e,0,0,1)||new N(e)}static atEnd(e){return z(e,e,e.content.size,e.childCount,-1)||new N(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=ge[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in ge)throw new RangeError("Duplicate use of selection JSON ID "+e);return ge[e]=t,t.prototype.jsonID=e,t}getBookmark(){return R.between(this.$anchor,this.$head).getBookmark()}};m.prototype.visible=!0;var we=class{constructor(e,t){this.$from=e,this.$to=t}},Ue=!1;function Ge(i){!Ue&&!i.parent.inlineContent&&(Ue=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+i.parent.type.name+")"))}var R=class i extends m{constructor(e,t=e){Ge(e),Ge(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return m.near(n);let r=e.resolve(t.map(this.anchor));return new i(r.parent.inlineContent?r:n,n)}replace(e,t=c.empty){if(super.replace(e,t),t==c.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof i&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new te(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new i(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(e,t,n){let r=e.pos-t.pos;if((!n||r)&&(n=r>=0?1:-1),!t.parent.inlineContent){let s=m.findFrom(t,n,!0)||m.findFrom(t,-n,!0);if(s)t=s.$head;else return m.near(t,n)}return e.parent.inlineContent||(r==0?e=t:(e=(m.findFrom(e,-n,!0)||m.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=r<0&&(e=t))),new i(e,t)}};m.jsonID("text",R);var te=class i{constructor(e,t){this.anchor=e,this.head=t}map(e){return new i(e.map(this.anchor),e.map(this.head))}resolve(e){return R.between(e.resolve(this.anchor),e.resolve(this.head))}},b=class i extends m{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:r}=t.mapResult(this.anchor),s=e.resolve(r);return n?m.near(s):new i(s)}content(){return new c(d.from(this.node),0,0)}eq(e){return e instanceof i&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new xe(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new i(e.resolve(t.anchor))}static create(e,t){return new i(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};b.prototype.visible=!1;m.jsonID("node",b);var xe=class i{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new te(n,n):new i(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&b.isSelectable(n)?new b(t):m.near(t)}},N=class i extends m{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=c.empty){if(t==c.empty){e.delete(0,e.doc.content.size);let n=m.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new i(e)}map(e){return new i(e)}eq(e){return e instanceof i}getBookmark(){return ut}};m.jsonID("all",N);var ut={map(){return this},resolve(i){return new N(i)}};function z(i,e,t,n,r,s=!1){if(e.inlineContent)return R.create(i,t);for(let l=n-(r>0?0:1);r>0?l<e.childCount:l>=0;l+=r){let o=e.child(l);if(o.isAtom){if(!s&&b.isSelectable(o))return b.create(i,t-(r<0?o.nodeSize:0))}else{let a=z(i,o,t+r,r<0?o.childCount:0,r,s);if(a)return a}t+=o.nodeSize*r}return null}function Ve(i,e,t){let n=i.steps.length-1;if(n<e)return;let r=i.steps[n];if(!(r instanceof P||r instanceof W))return;let s=i.mapping.maps[n],l;s.forEach((o,a,h,f)=>{l==null&&(l=f)}),i.setSelection(m.near(i.doc.resolve(l),t))}function He(i,e){return!e||!i?i:i.bind(e)}var F=class{constructor(e,t,n){this.name=e,this.init=He(t.init,n),this.apply=He(t.apply,n)}},Rt=[new F("doc",{init(i){return i.doc||i.schema.topNodeType.createAndFill()},apply(i){return i.doc}}),new F("selection",{init(i,e){return i.selection||m.atStart(e.doc)},apply(i){return i.selection}}),new F("storedMarks",{init(i){return i.storedMarks||null},apply(i,e,t,n){return n.selection.$cursor?i.storedMarks:null}}),new F("scrollToSelection",{init(){return 0},apply(i,e){return i.scrolledIntoView?e+1:e}})];function Ke(i,e,t){for(let n in i){let r=i[n];r instanceof Function?r=r.bind(e):n=="handleDOMEvents"&&(r=Ke(r,e,{})),t[n]=r}return t}var ne=class{constructor(e){this.spec=e,this.props={},e.props&&Ke(e.props,this,this.props),this.key=e.key?e.key.key:je("plugin")}getState(e){return e[this.key]}},ye=Object.create(null);function je(i){return i in ye?i+"$"+ ++ye[i]:(ye[i]=0,i+"$")}var q=class{constructor(e="key"){this.key=je(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var dt=500,A=class i{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let r,s;t&&(r=this.remapping(n,this.items.length),s=r.maps.length);let l=e.tr,o,a,h=[],f=[];return this.items.forEach((p,u)=>{if(!p.step){r||(r=this.remapping(n,u+1),s=r.maps.length),s--,f.push(p);return}if(r){f.push(new S(p.map));let g=p.step.map(r.slice(s)),M;g&&l.maybeStep(g).doc&&(M=l.mapping.maps[l.mapping.maps.length-1],h.push(new S(M,void 0,void 0,h.length+f.length))),s--,M&&r.appendMap(M,s)}else l.maybeStep(p.step);if(p.selection)return o=r?p.selection.map(r.slice(s)):p.selection,a=new i(this.items.slice(0,n).append(f.reverse().concat(h)),this.eventCount-1),!1},this.items.length,0),{remaining:a,transform:l,selection:o}}addTransform(e,t,n,r){let s=[],l=this.eventCount,o=this.items,a=!r&&o.length?o.get(o.length-1):null;for(let f=0;f<e.steps.length;f++){let p=e.steps[f].invert(e.docs[f]),u=new S(e.mapping.maps[f],p,t),g;(g=a&&a.merge(u))&&(u=g,f?s.pop():o=o.slice(0,o.length-1)),s.push(u),t&&(l++,t=void 0),r||(a=u)}let h=l-n.depth;return h>gt&&(o=mt(o,h),l-=h),new i(o.append(s),l)}remapping(e,t){let n=new X;return this.items.forEach((r,s)=>{let l=r.mirrorOffset!=null&&s-r.mirrorOffset>=e?n.maps.length-r.mirrorOffset:void 0;n.appendMap(r.map,l)},e,t),n}addMaps(e){return this.eventCount==0?this:new i(this.items.append(e.map(t=>new S(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-t),s=e.mapping,l=e.steps.length,o=this.eventCount;this.items.forEach(u=>{u.selection&&o--},r);let a=t;this.items.forEach(u=>{let g=s.getMirror(--a);if(g==null)return;l=Math.min(l,g);let M=s.maps[g];if(u.step){let U=e.steps[g].invert(e.docs[g]),ve=u.selection&&u.selection.map(s.slice(a+1,g));ve&&o++,n.push(new S(M,U,ve))}else n.push(new S(M))},r);let h=[];for(let u=t;u<l;u++)h.push(new S(s.maps[u]));let f=this.items.slice(0,r).append(h).append(n),p=new i(f,o);return p.emptyItemCount()>dt&&(p=p.compress(this.items.length-n.length)),p}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,r=[],s=0;return this.items.forEach((l,o)=>{if(o>=e)r.push(l),l.selection&&s++;else if(l.step){let a=l.step.map(t.slice(n)),h=a&&a.getMap();if(n--,h&&t.appendMap(h,n),a){let f=l.selection&&l.selection.map(t.slice(n));f&&s++;let p=new S(h.invert(),a,f),u,g=r.length-1;(u=r.length&&r[g].merge(p))?r[g]=u:r.push(p)}}else l.map&&n--},this.items.length,0),new i(se.from(r.reverse()),s)}};A.empty=new A(se.empty,0);function mt(i,e){let t;return i.forEach((n,r)=>{if(n.selection&&e--==0)return t=r,!1}),i.slice(t)}var S=class i{constructor(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new i(t.getMap().invert(),t,this.selection)}}},v=class{constructor(e,t,n,r,s){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r,this.prevComposition=s}},gt=20;function yt(i,e,t,n){let r=t.getMeta(C),s;if(r)return r.historyState;t.getMeta(Xe)&&(i=new v(i.done,i.undone,null,0,-1));let l=t.getMeta("appendedTransaction");if(t.steps.length==0)return i;if(l&&l.getMeta(C))return l.getMeta(C).redo?new v(i.done.addTransform(t,void 0,n,ie(e)),i.undone,Ze(t.mapping.maps),i.prevTime,i.prevComposition):new v(i.done,i.undone.addTransform(t,void 0,n,ie(e)),null,i.prevTime,i.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(l&&l.getMeta("addToHistory")===!1)){let o=t.getMeta("composition"),a=i.prevTime==0||!l&&i.prevComposition!=o&&(i.prevTime<(t.time||0)-n.newGroupDelay||!wt(t,i.prevRanges)),h=l?ke(i.prevRanges,t.mapping):Ze(t.mapping.maps);return new v(i.done.addTransform(t,a?e.selection.getBookmark():void 0,n,ie(e)),A.empty,h,t.time,o??i.prevComposition)}else return(s=t.getMeta("rebased"))?new v(i.done.rebased(t,s),i.undone.rebased(t,s),ke(i.prevRanges,t.mapping),i.prevTime,i.prevComposition):new v(i.done.addMaps(t.mapping.maps),i.undone.addMaps(t.mapping.maps),ke(i.prevRanges,t.mapping),i.prevTime,i.prevComposition)}function wt(i,e){if(!e)return!1;if(!i.docChanged)return!0;let t=!1;return i.mapping.maps[0].forEach((n,r)=>{for(let s=0;s<e.length;s+=2)n<=e[s+1]&&r>=e[s]&&(t=!0)}),t}function Ze(i){let e=[];for(let t=i.length-1;t>=0&&e.length==0;t--)i[t].forEach((n,r,s,l)=>e.push(s,l));return e}function ke(i,e){if(!i)return null;let t=[];for(let n=0;n<i.length;n+=2){let r=e.map(i[n],1),s=e.map(i[n+1],-1);r<=s&&t.push(r,s)}return t}function xt(i,e,t){let n=ie(e),r=C.get(e).spec.config,s=(t?i.undone:i.done).popEvent(e,n);if(!s)return null;let l=s.selection.resolve(s.transform.doc),o=(t?i.done:i.undone).addTransform(s.transform,e.selection.getBookmark(),r,n),a=new v(t?o:s.remaining,t?s.remaining:o,null,0,-1);return s.transform.setSelection(l).setMeta(C,{redo:t,historyState:a})}var Se=!1,Qe=null;function ie(i){let e=i.plugins;if(Qe!=e){Se=!1,Qe=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){Se=!0;break}}return Se}function Dt(i){return i.setMeta(Xe,!0)}var C=new q("history"),Xe=new q("closeHistory");function Bt(i={}){return i={depth:i.depth||100,newGroupDelay:i.newGroupDelay||500},new ne({key:C,state:{init(){return new v(A.empty,A.empty,null,0,-1)},apply(e,t,n){return yt(t,n,e,i)}},config:i,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,r=n=="historyUndo"?kt:n=="historyRedo"?St:null;return r?(t.preventDefault(),r(e.state,e.dispatch)):!1}}}})}function re(i,e){return(t,n)=>{let r=C.getState(t);if(!r||(i?r.undone:r.done).eventCount==0)return!1;if(n){let s=xt(r,t,i);s&&n(e?s.scrollIntoView():s)}return!0}}var kt=re(!1,!0),St=re(!0,!0),Pt=re(!1,!1),Wt=re(!0,!1);function Lt(i){let e=C.getState(i);return e?e.done.eventCount:0}function qt(i){let e=C.getState(i);return e?e.undone.eventCount:0}export{Dt as closeHistory,Bt as history,St as redo,qt as redoDepth,Wt as redoNoScroll,kt as undo,Lt as undoDepth,Pt as undoNoScroll};
//# sourceMappingURL=prosemirror-history.bundle.mjs.map