/* esm.sh - @tiptap/extension-table@2.0.0-beta.209 */
import{findParentNodeClosestToPos as W,Node as M,mergeAttributes as A,callOrReturn as E,getExtensionField as H}from "@tiptap/core";import{CellSelection as x,addColumnBefore as z,addColumnAfter as k,deleteColumn as v,addRowBefore as B,addRowAfter as O,deleteRow as P,deleteTable as D,mergeCells as g,splitCell as T,toggleHeader as w,toggleHeaderCell as L,setCellAttr as $,goToNextCell as y,fixTables as V,columnResizing as j,tableEditing as F}from "@tiptap/prosemirror-tables";import{TextSelection as I}from "prosemirror-state";function R(t,e,l,r,d,o){let s=0,c=!0,n=e.firstChild,i=t.firstChild;for(let a=0,u=0;a<i.childCount;a+=1){let{colspan:N,colwidth:C}=i.child(a).attrs;for(let b=0;b<N;b+=1,u+=1){let h=d===u?o:C&&C[b],p=h?`${h}px`:"";s+=h||r,h||(c=!1),n?(n.style.width!==p&&(n.style.width=p),n=n.nextSibling):e.appendChild(document.createElement("col")).style.width=p}}for(;n;){let a=n.nextSibling;n.parentNode.removeChild(n),n=a}c?(l.style.width=`${s}px`,l.style.minWidth=""):(l.style.width="",l.style.minWidth=`${s}px`)}var m=class{constructor(e,l){this.node=e,this.cellMinWidth=l,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),R(e,this.colgroup,this.table,l),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,R(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type==="attributes"&&(e.target===this.table||this.colgroup.contains(e.target))}};function S(t,e){return e?t.createChecked(null,e):t.createAndFill()}function K(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;let e={};return Object.keys(t.nodes).forEach(l=>{let r=t.nodes[l];r.spec.tableRole&&(e[r.spec.tableRole]=r)}),t.cached.tableNodeTypes=e,e}function _(t,e,l,r,d){let o=K(t),s=[],c=[];for(let i=0;i<l;i+=1){let a=S(o.cell,d);if(a&&c.push(a),r){let u=S(o.header_cell,d);u&&s.push(u)}}let n=[];for(let i=0;i<e;i+=1)n.push(o.row.createChecked(null,r&&i===0?s:c));return o.table.createChecked(null,n)}function q(t){return t instanceof x}var f=({editor:t})=>{let{selection:e}=t.state;if(!q(e))return!1;let l=0,r=W(e.ranges[0].$from,o=>o.type.name==="table");return r?.node.descendants(o=>{if(o.type.name==="table")return!1;["tableCell","tableHeader"].includes(o.type.name)&&(l+=1)}),l===e.ranges.length?(t.commands.deleteTable(),!0):!1},U=M.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:m,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({HTMLAttributes:t}){return["table",A(this.options.HTMLAttributes,t),["tbody",0]]},addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:l=!0}={})=>({tr:r,dispatch:d,editor:o})=>{let s=_(o.schema,t,e,l);if(d){let c=r.selection.anchor+1;r.replaceSelectionWith(s).scrollIntoView().setSelection(I.near(r.doc.resolve(c)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>z(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>k(t,e),deleteColumn:()=>({state:t,dispatch:e})=>v(t,e),addRowBefore:()=>({state:t,dispatch:e})=>B(t,e),addRowAfter:()=>({state:t,dispatch:e})=>O(t,e),deleteRow:()=>({state:t,dispatch:e})=>P(t,e),deleteTable:()=>({state:t,dispatch:e})=>D(t,e),mergeCells:()=>({state:t,dispatch:e})=>g(t,e),splitCell:()=>({state:t,dispatch:e})=>T(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>w("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>w("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>L(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>g(t,e)?!0:T(t,e),setCellAttribute:(t,e)=>({state:l,dispatch:r})=>$(t,e)(l,r),goToNextCell:()=>({state:t,dispatch:e})=>y(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>y(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&V(t),!0),setCellSelection:t=>({tr:e,dispatch:l})=>{if(l){let r=x.create(e.doc,t.anchorCell,t.headCell);e.setSelection(r)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:f,"Mod-Backspace":f,Delete:f,"Mod-Delete":f}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[j({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],F({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){let e={name:t.name,options:t.options,storage:t.storage};return{tableRole:E(H(t,"tableRole",e))}}});export{U as Table,_ as createTable,U as default};
//# sourceMappingURL=extension-table.bundle.mjs.map