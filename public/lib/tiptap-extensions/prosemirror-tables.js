/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/prosemirror-tables@1.6.4/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{PluginKey as t,Selection as e,TextSelection as o,SelectionRange as n,Plugin as l,NodeSelection as r}from "prosemirror-state";import{Fragment as s,Slice as i}from "prosemirror-model";import{DecorationSet as a,Decoration as c}from "prosemirror-view";import{keydownHandler as p}from "prosemirror-keymap";import{Transform as d}from "prosemirror-transform";var h,f;if("undefined"!=typeof WeakMap){let t=new WeakMap;h=e=>t.get(e),f=(e,o)=>(t.set(e,o),o)}else{const t=[],e=10;let o=0;h=e=>{for(let o=0;o<t.length;o+=2)if(t[o]==e)return t[o+1]},f=(n,l)=>(o==e&&(o=0),t[o++]=n,t[o++]=l)}var u=class{constructor(t,e,o,n){this.width=t,this.height=e,this.map=o,this.problems=n}findCell(t){for(let e=0;e<this.map.length;e++){const o=this.map[e];if(o!=t)continue;const n=e%this.width,l=e/this.width|0;let r=n+1,s=l+1;for(let t=1;r<this.width&&this.map[e+t]==o;t++)r++;for(let t=1;s<this.height&&this.map[e+this.width*t]==o;t++)s++;return{left:n,top:l,right:r,bottom:s}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,o){const{left:n,right:l,top:r,bottom:s}=this.findCell(t);return"horiz"==e?(o<0?0==n:l==this.width)?null:this.map[r*this.width+(o<0?n-1:l)]:(o<0?0==r:s==this.height)?null:this.map[n+this.width*(o<0?r-1:s)]}rectBetween(t,e){const{left:o,right:n,top:l,bottom:r}=this.findCell(t),{left:s,right:i,top:a,bottom:c}=this.findCell(e);return{left:Math.min(o,s),top:Math.min(l,a),right:Math.max(n,i),bottom:Math.max(r,c)}}cellsInRect(t){const e=[],o={};for(let n=t.top;n<t.bottom;n++)for(let l=t.left;l<t.right;l++){const r=n*this.width+l,s=this.map[r];o[s]||(o[s]=!0,l==t.left&&l&&this.map[r-1]==s||n==t.top&&n&&this.map[r-this.width]==s||e.push(s))}return e}positionAt(t,e,o){for(let n=0,l=0;;n++){const r=l+o.child(n).nodeSize;if(n==t){let o=e+t*this.width;const n=(t+1)*this.width;for(;o<n&&this.map[o]<l;)o++;return o==n?r-1:this.map[o]}l=r}}static get(t){return h(t)||f(t,function(t){if("table"!=t.type.spec.tableRole)throw new RangeError("Not a table node: "+t.type.name);const e=function(t){let e=-1,o=!1;for(let n=0;n<t.childCount;n++){const l=t.child(n);let r=0;if(o)for(let e=0;e<n;e++){const o=t.child(e);for(let t=0;t<o.childCount;t++){const l=o.child(t);e+l.attrs.rowspan>n&&(r+=l.attrs.colspan)}}for(let t=0;t<l.childCount;t++){const e=l.child(t);r+=e.attrs.colspan,e.attrs.rowspan>1&&(o=!0)}-1==e?e=r:e!=r&&(e=Math.max(e,r))}return e}(t),o=t.childCount,n=[];let l=0,r=null;const s=[];for(let t=0,l=e*o;t<l;t++)n[t]=0;for(let i=0,a=0;i<o;i++){const c=t.child(i);a++;for(let t=0;;t++){for(;l<n.length&&0!=n[l];)l++;if(t==c.childCount)break;const p=c.child(t),{colspan:d,rowspan:h,colwidth:f}=p.attrs;for(let t=0;t<h;t++){if(t+i>=o){(r||(r=[])).push({type:"overlong_rowspan",pos:a,n:h-t});break}const c=l+t*e;for(let t=0;t<d;t++){0==n[c+t]?n[c+t]=a:(r||(r=[])).push({type:"collision",row:i,pos:a,n:d-t});const o=f&&f[t];if(o){const n=(c+t)%e*2,l=s[n];null==l||l!=o&&1==s[n+1]?(s[n]=o,s[n+1]=1):l==o&&s[n+1]++}}}l+=d,a+=p.nodeSize}const p=(i+1)*e;let d=0;for(;l<p;)0==n[l++]&&d++;d&&(r||(r=[])).push({type:"missing",row:i,n:d}),a++}0!==e&&0!==o||(r||(r=[])).push({type:"zero_sized"});const i=new u(e,o,n,r);let a=!1;for(let t=0;!a&&t<s.length;t+=2)null!=s[t]&&s[t+1]<o&&(a=!0);a&&function(t,e,o){t.problems||(t.problems=[]);const n={};for(let l=0;l<t.map.length;l++){const r=t.map[l];if(n[r])continue;n[r]=!0;const s=o.nodeAt(r);if(!s)throw new RangeError(`No cell with offset ${r} found`);let i=null;const a=s.attrs;for(let o=0;o<a.colspan;o++){const n=e[2*((l+o)%t.width)];null==n||a.colwidth&&a.colwidth[o]==n||((i||(i=m(a)))[o]=n)}i&&t.problems.unshift({type:"colwidth mismatch",pos:r,colwidth:i})}}(i,s,t);return i}(t))}};function m(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let o=0;o<t.colspan;o++)e.push(0);return e}function w(t,e){if("string"==typeof t)return{};const o=t.getAttribute("data-colwidth"),n=o&&/^\d+(,\d+)*$/.test(o)?o.split(",").map((t=>Number(t))):null,l=Number(t.getAttribute("colspan")||1),r={colspan:l,rowspan:Number(t.getAttribute("rowspan")||1),colwidth:n&&n.length==l?n:null};for(const o in e){const n=e[o].getFromDOM,l=n&&n(t);null!=l&&(r[o]=l)}return r}function g(t,e){const o={};1!=t.attrs.colspan&&(o.colspan=t.attrs.colspan),1!=t.attrs.rowspan&&(o.rowspan=t.attrs.rowspan),t.attrs.colwidth&&(o["data-colwidth"]=t.attrs.colwidth.join(","));for(const n in e){const l=e[n].setDOMAttr;l&&l(t.attrs[n],o)}return o}function b(t){const e=t.cellAttributes||{},o={colspan:{default:1},rowspan:{default:1},colwidth:{default:null}};for(const t in e)o[t]={default:e[t].default};return{table:{content:"table_row+",tableRole:"table",isolating:!0,group:t.tableGroup,parseDOM:[{tag:"table"}],toDOM:()=>["table",["tbody",0]]},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM:()=>["tr",0]},table_cell:{content:t.cellContent,attrs:o,tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs:t=>w(t,e)}],toDOM:t=>["td",g(t,e),0]},table_header:{content:t.cellContent,attrs:o,tableRole:"header_cell",isolating:!0,parseDOM:[{tag:"th",getAttrs:t=>w(t,e)}],toDOM:t=>["th",g(t,e),0]}}}function C(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const o in t.nodes){const n=t.nodes[o],l=n.spec.tableRole;l&&(e[l]=n)}}return e}var v=new t("selectingCells");function y(t){for(let e=t.depth-1;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return t.node(0).resolve(t.before(e+1));return null}function A(t){const e=t.selection.$head;for(let t=e.depth;t>0;t--)if("row"==e.node(t).type.spec.tableRole)return!0;return!1}function S(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&"cell"==e.node.type.spec.tableRole)return e.$anchor;const o=y(e.$head)||$(e.$head);if(o)return o;throw new RangeError(`No cell found around position ${e.head}`)}function $(t){for(let e=t.nodeAfter,o=t.pos;e;e=e.firstChild,o++){const n=e.type.spec.tableRole;if("cell"==n||"header_cell"==n)return t.doc.resolve(o)}for(let e=t.nodeBefore,o=t.pos;e;e=e.lastChild,o--){const n=e.type.spec.tableRole;if("cell"==n||"header_cell"==n)return t.doc.resolve(o-e.nodeSize)}}function M(t){return"row"==t.parent.type.spec.tableRole&&!!t.nodeAfter}function R(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function N(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function z(t){return u.get(t.node(-1)).findCell(t.pos-t.start(-1))}function x(t){return u.get(t.node(-1)).colCount(t.pos-t.start(-1))}function E(t,e,o){const n=t.node(-1),l=u.get(n),r=t.start(-1),s=l.nextCell(t.pos-r,e,o);return null==s?null:t.node(0).resolve(r+s)}function k(t,e,o=1){const n={...t,colspan:t.colspan-o};return n.colwidth&&(n.colwidth=n.colwidth.slice(),n.colwidth.splice(e,o),n.colwidth.some((t=>t>0))||(n.colwidth=null)),n}function _(t,e,o=1){const n={...t,colspan:t.colspan+o};if(n.colwidth){n.colwidth=n.colwidth.slice();for(let t=0;t<o;t++)n.colwidth.splice(e,0,0)}return n}function D(t,e,o){const n=C(e.type.schema).header_cell;for(let l=0;l<t.height;l++)if(e.nodeAt(t.map[o+l*t.width]).type!=n)return!1;return!0}var H=class t extends e{constructor(t,e=t){const o=t.node(-1),l=u.get(o),r=t.start(-1),s=l.rectBetween(t.pos-r,e.pos-r),i=t.node(0),a=l.cellsInRect(s).filter((t=>t!=e.pos-r));a.unshift(e.pos-r);const c=a.map((t=>{const e=o.nodeAt(t);if(!e)throw RangeError(`No cell with offset ${t} found`);const l=r+t+1;return new n(i.resolve(l),i.resolve(l+e.content.size))}));super(c[0].$from,c[0].$to,c),this.$anchorCell=t,this.$headCell=e}map(e,n){const l=e.resolve(n.map(this.$anchorCell.pos)),r=e.resolve(n.map(this.$headCell.pos));if(M(l)&&M(r)&&N(l,r)){const e=this.$anchorCell.node(-1)!=l.node(-1);return e&&this.isRowSelection()?t.rowSelection(l,r):e&&this.isColSelection()?t.colSelection(l,r):new t(l,r)}return o.between(l,r)}content(){const t=this.$anchorCell.node(-1),e=u.get(t),o=this.$anchorCell.start(-1),n=e.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o),l={},r=[];for(let o=n.top;o<n.bottom;o++){const i=[];for(let r=o*e.width+n.left,s=n.left;s<n.right;s++,r++){const o=e.map[r];if(l[o])continue;l[o]=!0;const s=e.findCell(o);let a=t.nodeAt(o);if(!a)throw RangeError(`No cell with offset ${o} found`);const c=n.left-s.left,p=s.right-n.right;if(c>0||p>0){let t=a.attrs;if(c>0&&(t=k(t,0,c)),p>0&&(t=k(t,t.colspan-p,p)),s.left<n.left){if(a=a.type.createAndFill(t),!a)throw RangeError(`Could not create cell with attrs ${JSON.stringify(t)}`)}else a=a.type.create(t,a.content)}if(s.top<n.top||s.bottom>n.bottom){const t={...a.attrs,rowspan:Math.min(s.bottom,n.bottom)-Math.max(s.top,n.top)};a=s.top<n.top?a.type.createAndFill(t):a.type.create(t,a.content)}i.push(a)}r.push(t.child(o).copy(s.from(i)))}const a=this.isColSelection()&&this.isRowSelection()?t:r;return new i(s.from(a),1,1)}replace(t,o=i.empty){const n=t.steps.length,l=this.ranges;for(let e=0;e<l.length;e++){const{$from:r,$to:s}=l[e],a=t.mapping.slice(n);t.replace(a.map(r.pos),a.map(s.pos),e?i.empty:o)}const r=e.findFrom(t.doc.resolve(t.mapping.slice(n).map(this.to)),-1);r&&t.setSelection(r)}replaceWith(t,e){this.replace(t,new i(s.from(e),0,0))}forEachCell(t){const e=this.$anchorCell.node(-1),o=u.get(e),n=this.$anchorCell.start(-1),l=o.cellsInRect(o.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n));for(let o=0;o<l.length;o++)t(e.nodeAt(l[o]),n+l[o])}isColSelection(){const t=this.$anchorCell.index(-1),e=this.$headCell.index(-1);if(Math.min(t,e)>0)return!1;const o=t+this.$anchorCell.nodeAfter.attrs.rowspan,n=e+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(o,n)==this.$headCell.node(-1).childCount}static colSelection(e,o=e){const n=e.node(-1),l=u.get(n),r=e.start(-1),s=l.findCell(e.pos-r),i=l.findCell(o.pos-r),a=e.node(0);return s.top<=i.top?(s.top>0&&(e=a.resolve(r+l.map[s.left])),i.bottom<l.height&&(o=a.resolve(r+l.map[l.width*(l.height-1)+i.right-1]))):(i.top>0&&(o=a.resolve(r+l.map[i.left])),s.bottom<l.height&&(e=a.resolve(r+l.map[l.width*(l.height-1)+s.right-1]))),new t(e,o)}isRowSelection(){const t=this.$anchorCell.node(-1),e=u.get(t),o=this.$anchorCell.start(-1),n=e.colCount(this.$anchorCell.pos-o),l=e.colCount(this.$headCell.pos-o);if(Math.min(n,l)>0)return!1;const r=n+this.$anchorCell.nodeAfter.attrs.colspan,s=l+this.$headCell.nodeAfter.attrs.colspan;return Math.max(r,s)==e.width}eq(e){return e instanceof t&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,o=e){const n=e.node(-1),l=u.get(n),r=e.start(-1),s=l.findCell(e.pos-r),i=l.findCell(o.pos-r),a=e.node(0);return s.left<=i.left?(s.left>0&&(e=a.resolve(r+l.map[s.top*l.width])),i.right<l.width&&(o=a.resolve(r+l.map[l.width*(i.top+1)-1]))):(i.left>0&&(o=a.resolve(r+l.map[i.top*l.width])),s.right<l.width&&(e=a.resolve(r+l.map[l.width*(s.top+1)-1]))),new t(e,o)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,o){return new t(e.resolve(o.anchor),e.resolve(o.head))}static create(e,o,n=o){return new t(e.resolve(o),e.resolve(n))}getBookmark(){return new L(this.$anchorCell.pos,this.$headCell.pos)}};H.prototype.visible=!1,e.jsonID("cell",H);var L=class t{constructor(t,e){this.anchor=t,this.head=e}map(e){return new t(e.map(this.anchor),e.map(this.head))}resolve(t){const o=t.resolve(this.anchor),n=t.resolve(this.head);return"row"==o.parent.type.spec.tableRole&&"row"==n.parent.type.spec.tableRole&&o.index()<o.parent.childCount&&n.index()<n.parent.childCount&&N(o,n)?new H(o,n):e.near(n,1)}};function O(t){if(!(t.selection instanceof H))return null;const e=[];return t.selection.forEachCell(((t,o)=>{e.push(c.node(o,o+t.nodeSize,{class:"selectedCell"}))})),a.create(t.doc,e)}var F=new t("fix-tables");function B(t,e,o,n){const l=t.childCount,r=e.childCount;t:for(let s=0,i=0;s<r;s++){const r=e.child(s);for(let e=i,n=Math.min(l,s+3);e<n;e++)if(t.child(e)==r){i=e+1,o+=r.nodeSize;continue t}n(r,o),i<l&&t.child(i).sameMarkup(r)?B(t.child(i),r,o+1,n):r.nodesBetween(0,r.content.size,n,o+1),o+=r.nodeSize}}function W(t,e){let o;const n=(e,n)=>{"table"==e.type.spec.tableRole&&(o=function(t,e,o,n){const l=u.get(e);if(!l.problems)return n;n||(n=t.tr);const r=[];for(let t=0;t<l.height;t++)r.push(0);for(let t=0;t<l.problems.length;t++){const s=l.problems[t];if("collision"==s.type){const t=e.nodeAt(s.pos);if(!t)continue;const l=t.attrs;for(let t=0;t<l.rowspan;t++)r[s.row+t]+=s.n;n.setNodeMarkup(n.mapping.map(o+1+s.pos),null,k(l,l.colspan-s.n,s.n))}else if("missing"==s.type)r[s.row]+=s.n;else if("overlong_rowspan"==s.type){const t=e.nodeAt(s.pos);if(!t)continue;n.setNodeMarkup(n.mapping.map(o+1+s.pos),null,{...t.attrs,rowspan:t.attrs.rowspan-s.n})}else if("colwidth mismatch"==s.type){const t=e.nodeAt(s.pos);if(!t)continue;n.setNodeMarkup(n.mapping.map(o+1+s.pos),null,{...t.attrs,colwidth:s.colwidth})}else if("zero_sized"==s.type){const t=n.mapping.map(o);n.delete(t,t+e.nodeSize)}}let s,i;for(let t=0;t<r.length;t++)r[t]&&(null==s&&(s=t),i=t);for(let a=0,c=o+1;a<l.height;a++){const o=e.child(a),l=c+o.nodeSize,p=r[a];if(p>0){let e="cell";o.firstChild&&(e=o.firstChild.type.spec.tableRole);const r=[];for(let o=0;o<p;o++){const o=C(t.schema)[e].createAndFill();o&&r.push(o)}const d=0!=a&&s!=a-1||i!=a?l-1:c+1;n.insert(n.mapping.map(d),r)}c=l}return n.setMeta(F,{fixTables:!0})}(t,e,n,o))};return e?e.doc!=t.doc&&B(e.doc,t.doc,0,n):t.doc.descendants(n),o}function T(t){const e=t.selection,o=S(t),n=o.node(-1),l=o.start(-1),r=u.get(n);return{...e instanceof H?r.rectBetween(e.$anchorCell.pos-l,e.$headCell.pos-l):r.findCell(o.pos-l),tableStart:l,map:r,table:n}}function I(t,{map:e,tableStart:o,table:n},l){let r=l>0?-1:0;D(e,n,l+r)&&(r=0==l||l==e.width?null:0);for(let s=0;s<e.height;s++){const i=s*e.width+l;if(l>0&&l<e.width&&e.map[i-1]==e.map[i]){const r=e.map[i],a=n.nodeAt(r);t.setNodeMarkup(t.mapping.map(o+r),null,_(a.attrs,l-e.colCount(r))),s+=a.attrs.rowspan-1}else{const a=null==r?C(n.type.schema).cell:n.nodeAt(e.map[i+r]).type,c=e.positionAt(s,l,n);t.insert(t.mapping.map(o+c),a.createAndFill())}}return t}function X(t,e){if(!A(t))return!1;if(e){const o=T(t);e(I(t.tr,o,o.left))}return!0}function V(t,e){if(!A(t))return!1;if(e){const o=T(t);e(I(t.tr,o,o.right))}return!0}function K(t,{map:e,table:o,tableStart:n},l){const r=t.mapping.maps.length;for(let s=0;s<e.height;){const i=s*e.width+l,a=e.map[i],c=o.nodeAt(a),p=c.attrs;if(l>0&&e.map[i-1]==a||l<e.width-1&&e.map[i+1]==a)t.setNodeMarkup(t.mapping.slice(r).map(n+a),null,k(p,l-e.colCount(a)));else{const e=t.mapping.slice(r).map(n+a);t.delete(e,e+c.nodeSize)}s+=p.rowspan}}function P(t,e){if(!A(t))return!1;if(e){const o=T(t),n=t.tr;if(0==o.left&&o.right==o.map.width)return!1;for(let t=o.right-1;K(n,o,t),t!=o.left;t--){const t=o.tableStart?n.doc.nodeAt(o.tableStart-1):n.doc;if(!t)throw RangeError("No table found");o.table=t,o.map=u.get(t)}e(n)}return!0}function q(t,e,o){var n;const l=C(e.type.schema).header_cell;for(let r=0;r<t.width;r++)if((null==(n=e.nodeAt(t.map[r+o*t.width]))?void 0:n.type)!=l)return!1;return!0}function J(t,{map:e,tableStart:o,table:n},l){var r;let s=o;for(let t=0;t<l;t++)s+=n.child(t).nodeSize;const i=[];let a=l>0?-1:0;q(e,n,l+a)&&(a=0==l||l==e.height?null:0);for(let s=0,c=e.width*l;s<e.width;s++,c++)if(l>0&&l<e.height&&e.map[c]==e.map[c-e.width]){const l=e.map[c],r=n.nodeAt(l).attrs;t.setNodeMarkup(o+l,null,{...r,rowspan:r.rowspan+1}),s+=r.colspan-1}else{const t=null==a?C(n.type.schema).cell:null==(r=n.nodeAt(e.map[c+a*e.width]))?void 0:r.type,o=null==t?void 0:t.createAndFill();o&&i.push(o)}return t.insert(s,C(n.type.schema).row.create(null,i)),t}function j(t,e){if(!A(t))return!1;if(e){const o=T(t);e(J(t.tr,o,o.top))}return!0}function U(t,e){if(!A(t))return!1;if(e){const o=T(t);e(J(t.tr,o,o.bottom))}return!0}function Y(t,{map:e,table:o,tableStart:n},l){let r=0;for(let t=0;t<l;t++)r+=o.child(t).nodeSize;const s=r+o.child(l).nodeSize,i=t.mapping.maps.length;t.delete(r+n,s+n);const a=new Set;for(let r=0,s=l*e.width;r<e.width;r++,s++){const c=e.map[s];if(!a.has(c))if(a.add(c),l>0&&c==e.map[s-e.width]){const e=o.nodeAt(c).attrs;t.setNodeMarkup(t.mapping.slice(i).map(c+n),null,{...e,rowspan:e.rowspan-1}),r+=e.colspan-1}else if(l<e.height&&c==e.map[s+e.width]){const s=o.nodeAt(c),a=s.attrs,p=s.type.create({...a,rowspan:s.attrs.rowspan-1},s.content),d=e.positionAt(l+1,r,o);t.insert(t.mapping.slice(i).map(n+d),p),r+=a.colspan-1}}}function G(t,e){if(!A(t))return!1;if(e){const o=T(t),n=t.tr;if(0==o.top&&o.bottom==o.map.height)return!1;for(let t=o.bottom-1;Y(n,o,t),t!=o.top;t--){const t=o.tableStart?n.doc.nodeAt(o.tableStart-1):n.doc;if(!t)throw RangeError("No table found");o.table=t,o.map=u.get(o.table)}e(n)}return!0}function Q(t){const e=t.content;return 1==e.childCount&&e.child(0).isTextblock&&0==e.child(0).childCount}function Z(t,e){const o=t.selection;if(!(o instanceof H)||o.$anchorCell.pos==o.$headCell.pos)return!1;const n=T(t),{map:l}=n;if(function({width:t,height:e,map:o},n){let l=n.top*t+n.left,r=l,s=(n.bottom-1)*t+n.left,i=l+(n.right-n.left-1);for(let e=n.top;e<n.bottom;e++){if(n.left>0&&o[r]==o[r-1]||n.right<t&&o[i]==o[i+1])return!0;r+=t,i+=t}for(let r=n.left;r<n.right;r++){if(n.top>0&&o[l]==o[l-t]||n.bottom<e&&o[s]==o[s+t])return!0;l++,s++}return!1}(l,n))return!1;if(e){const o=t.tr,r={};let i,a,c=s.empty;for(let t=n.top;t<n.bottom;t++)for(let e=n.left;e<n.right;e++){const s=l.map[t*l.width+e],p=n.table.nodeAt(s);if(!r[s]&&p)if(r[s]=!0,null==i)i=s,a=p;else{Q(p)||(c=c.append(p.content));const t=o.mapping.map(s+n.tableStart);o.delete(t,t+p.nodeSize)}}if(null==i||null==a)return!0;if(o.setNodeMarkup(i+n.tableStart,null,{..._(a.attrs,a.attrs.colspan,n.right-n.left-a.attrs.colspan),rowspan:n.bottom-n.top}),c.size){const t=i+1+a.content.size,e=Q(a)?i+1:t;o.replaceWith(e+n.tableStart,t+n.tableStart,c)}o.setSelection(new H(o.doc.resolve(i+n.tableStart))),e(o)}return!0}function tt(t,e){const o=C(t.schema);return et((({node:t})=>o[t.type.spec.tableRole]))(t,e)}function et(t){return(e,o)=>{var n;const l=e.selection;let r,s;if(l instanceof H){if(l.$anchorCell.pos!=l.$headCell.pos)return!1;r=l.$anchorCell.nodeAfter,s=l.$anchorCell.pos}else{if(r=function(t){for(let e=t.depth;e>0;e--){const o=t.node(e).type.spec.tableRole;if("cell"===o||"header_cell"===o)return t.node(e)}return null}(l.$from),!r)return!1;s=null==(n=y(l.$from))?void 0:n.pos}if(null==r||null==s)return!1;if(1==r.attrs.colspan&&1==r.attrs.rowspan)return!1;if(o){let n=r.attrs;const i=[],a=n.colwidth;n.rowspan>1&&(n={...n,rowspan:1}),n.colspan>1&&(n={...n,colspan:1});const c=T(e),p=e.tr;for(let t=0;t<c.right-c.left;t++)i.push(a?{...n,colwidth:a&&a[t]?[a[t]]:null}:n);let d;for(let e=c.top;e<c.bottom;e++){let o=c.map.positionAt(e,c.left,c.table);e==c.top&&(o+=r.nodeSize);for(let n=c.left,l=0;n<c.right;n++,l++)n==c.left&&e==c.top||p.insert(d=p.mapping.map(o+c.tableStart,1),t({node:r,row:e,col:n}).createAndFill(i[l]))}p.setNodeMarkup(s,t({node:r,row:c.top,col:c.left}),i[0]),l instanceof H&&p.setSelection(new H(p.doc.resolve(l.$anchorCell.pos),d?p.doc.resolve(d):void 0)),o(p)}return!0}}function ot(t,e){return function(o,n){if(!A(o))return!1;const l=S(o);if(l.nodeAfter.attrs[t]===e)return!1;if(n){const r=o.tr;o.selection instanceof H?o.selection.forEachCell(((o,n)=>{o.attrs[t]!==e&&r.setNodeMarkup(n,null,{...o.attrs,[t]:e})})):r.setNodeMarkup(l.pos,null,{...l.nodeAfter.attrs,[t]:e}),n(r)}return!0}}function nt(t,e,o){const n=e.map.cellsInRect({left:0,top:0,right:"row"==t?e.map.width:1,bottom:"column"==t?e.map.height:1});for(let t=0;t<n.length;t++){const l=e.table.nodeAt(n[t]);if(l&&l.type!==o.header_cell)return!1}return!0}function lt(t,e){return(e=e||{useDeprecatedLogic:!1}).useDeprecatedLogic?function(t){return function(e,o){if(!A(e))return!1;if(o){const n=C(e.schema),l=T(e),r=e.tr,s=l.map.cellsInRect("column"==t?{left:l.left,top:0,right:l.right,bottom:l.map.height}:"row"==t?{left:0,top:l.top,right:l.map.width,bottom:l.bottom}:l),i=s.map((t=>l.table.nodeAt(t)));for(let t=0;t<s.length;t++)i[t].type==n.header_cell&&r.setNodeMarkup(l.tableStart+s[t],n.cell,i[t].attrs);if(0==r.steps.length)for(let t=0;t<s.length;t++)r.setNodeMarkup(l.tableStart+s[t],n.header_cell,i[t].attrs);o(r)}return!0}}(t):function(e,o){if(!A(e))return!1;if(o){const n=C(e.schema),l=T(e),r=e.tr,s=nt("row",l,n),i=nt("column",l,n),a=("column"===t?s:"row"===t&&i)?1:0,c="column"==t?{left:0,top:a,right:1,bottom:l.map.height}:"row"==t?{left:a,top:0,right:l.map.width,bottom:1}:l,p="column"==t?i?n.cell:n.header_cell:"row"==t?s?n.cell:n.header_cell:n.cell;l.map.cellsInRect(c).forEach((t=>{const e=t+l.tableStart,o=r.doc.nodeAt(e);o&&r.setNodeMarkup(e,p,o.attrs)})),o(r)}return!0}}var rt=lt("row",{useDeprecatedLogic:!0}),st=lt("column",{useDeprecatedLogic:!0}),it=lt("cell",{useDeprecatedLogic:!0});function at(t){return function(e,n){if(!A(e))return!1;const l=function(t,e){if(e<0){const e=t.nodeBefore;if(e)return t.pos-e.nodeSize;for(let e=t.index(-1)-1,o=t.before();e>=0;e--){const n=t.node(-1).child(e),l=n.lastChild;if(l)return o-1-l.nodeSize;o-=n.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const e=t.node(-1);for(let o=t.indexAfter(-1),n=t.after();o<e.childCount;o++){const t=e.child(o);if(t.childCount)return n+1;n+=t.nodeSize}}return null}(S(e),t);if(null==l)return!1;if(n){const t=e.doc.resolve(l);n(e.tr.setSelection(o.between(t,R(t))).scrollIntoView())}return!0}}function ct(t,e){const o=t.selection.$anchor;for(let n=o.depth;n>0;n--){if("table"==o.node(n).type.spec.tableRole)return e&&e(t.tr.delete(o.before(n),o.after(n)).scrollIntoView()),!0}return!1}function pt(t,e){const o=t.selection;if(!(o instanceof H))return!1;if(e){const n=t.tr,l=C(t.schema).cell.createAndFill().content;o.forEachCell(((t,e)=>{t.content.eq(l)||n.replace(n.mapping.map(e+1),n.mapping.map(e+t.nodeSize-1),new i(l,0,0))})),n.docChanged&&e(n)}return!0}function dt(t){if(!t.size)return null;let{content:e,openStart:o,openEnd:n}=t;for(;1==e.childCount&&(o>0&&n>0||"table"==e.child(0).type.spec.tableRole);)o--,n--,e=e.child(0).content;const l=e.child(0),r=l.type.spec.tableRole,a=l.type.schema,c=[];if("row"==r)for(let t=0;t<e.childCount;t++){let l=e.child(t).content;const r=t?0:Math.max(0,o-1),s=t<e.childCount-1?0:Math.max(0,n-1);(r||s)&&(l=ht(C(a).row,new i(l,r,s)).content),c.push(l)}else{if("cell"!=r&&"header_cell"!=r)return null;c.push(o||n?ht(C(a).row,new i(e,o,n)).content:e)}return function(t,e){const o=[];for(let t=0;t<e.length;t++){const n=e[t];for(let e=n.childCount-1;e>=0;e--){const{rowspan:l,colspan:r}=n.child(e).attrs;for(let e=t;e<t+l;e++)o[e]=(o[e]||0)+r}}let n=0;for(let t=0;t<o.length;t++)n=Math.max(n,o[t]);for(let l=0;l<o.length;l++)if(l>=e.length&&e.push(s.empty),o[l]<n){const r=C(t).cell.createAndFill(),i=[];for(let t=o[l];t<n;t++)i.push(r);e[l]=e[l].append(s.from(i))}return{height:e.length,width:n,rows:e}}(a,c)}function ht(t,e){const o=t.createAndFill();return new d(o).replace(0,o.content.size,e).doc}function ft({width:t,height:e,rows:o},n,l){if(t!=n){const e=[],l=[];for(let t=0;t<o.length;t++){const r=o[t],i=[];for(let o=e[t]||0,l=0;o<n;l++){let s=r.child(l%r.childCount);o+s.attrs.colspan>n&&(s=s.type.createChecked(k(s.attrs,s.attrs.colspan,o+s.attrs.colspan-n),s.content)),i.push(s),o+=s.attrs.colspan;for(let o=1;o<s.attrs.rowspan;o++)e[t+o]=(e[t+o]||0)+s.attrs.colspan}l.push(s.from(i))}o=l,t=n}if(e!=l){const t=[];for(let n=0,r=0;n<l;n++,r++){const i=[],a=o[r%e];for(let t=0;t<a.childCount;t++){let e=a.child(t);n+e.attrs.rowspan>l&&(e=e.type.create({...e.attrs,rowspan:Math.max(1,l-e.attrs.rowspan)},e.content)),i.push(e)}t.push(s.from(i))}o=t,e=l}return{width:t,height:e,rows:o}}function ut(t,e,o,n,l,r,s,i){if(0==s||s==e.height)return!1;let a=!1;for(let c=l;c<r;c++){const l=s*e.width+c,r=e.map[l];if(e.map[l-e.width]==r){a=!0;const l=o.nodeAt(r),{top:p,left:d}=e.findCell(r);t.setNodeMarkup(t.mapping.slice(i).map(r+n),null,{...l.attrs,rowspan:s-p}),t.insert(t.mapping.slice(i).map(e.positionAt(s,d,o)),l.type.createAndFill({...l.attrs,rowspan:p+l.attrs.rowspan-s})),c+=l.attrs.colspan-1}}return a}function mt(t,e,o,n,l,r,s,i){if(0==s||s==e.width)return!1;let a=!1;for(let c=l;c<r;c++){const l=c*e.width+s,r=e.map[l];if(e.map[l-1]==r){a=!0;const l=o.nodeAt(r),p=e.colCount(r),d=t.mapping.slice(i).map(r+n);t.setNodeMarkup(d,null,k(l.attrs,s-p,l.attrs.colspan-(s-p))),t.insert(d+l.nodeSize,l.type.createAndFill(k(l.attrs,0,s-p))),c+=l.attrs.rowspan-1}}return a}function wt(t,e,o,n,l){let r=o?t.doc.nodeAt(o-1):t.doc;if(!r)throw new Error("No table found");let a=u.get(r);const{top:c,left:p}=n,d=p+l.width,h=c+l.height,f=t.tr;let m=0;function w(){if(r=o?f.doc.nodeAt(o-1):f.doc,!r)throw new Error("No table found");a=u.get(r),m=f.mapping.maps.length}(function(t,e,o,n,l,r,i){const a=C(t.doc.type.schema);let c,p;if(l>e.width)for(let r=0,s=0;r<e.height;r++){const d=o.child(r);s+=d.nodeSize;const h=[];let f;f=null==d.lastChild||d.lastChild.type==a.cell?c||(c=a.cell.createAndFill()):p||(p=a.header_cell.createAndFill());for(let t=e.width;t<l;t++)h.push(f);t.insert(t.mapping.slice(i).map(s-1+n),h)}if(r>e.height){const d=[];for(let t=0,n=(e.height-1)*e.width;t<Math.max(e.width,l);t++){const l=!(t>=e.width)&&o.nodeAt(e.map[n+t]).type==a.header_cell;d.push(l?p||(p=a.header_cell.createAndFill()):c||(c=a.cell.createAndFill()))}const h=a.row.create(null,s.from(d)),f=[];for(let t=e.height;t<r;t++)f.push(h);t.insert(t.mapping.slice(i).map(n+o.nodeSize-2),f)}return!(!c&&!p)})(f,a,r,o,d,h,m)&&w(),ut(f,a,r,o,p,d,c,m)&&w(),ut(f,a,r,o,p,d,h,m)&&w(),mt(f,a,r,o,c,h,p,m)&&w(),mt(f,a,r,o,c,h,d,m)&&w();for(let t=c;t<h;t++){const e=a.positionAt(t,p,r),n=a.positionAt(t,d,r);f.replace(f.mapping.slice(m).map(e+o),f.mapping.slice(m).map(n+o),new i(l.rows[t-c],0,0))}w(),f.setSelection(new H(f.doc.resolve(o+a.positionAt(c,p,r)),f.doc.resolve(o+a.positionAt(h-1,d-1,r)))),e(f)}var gt=p({ArrowLeft:Ct("horiz",-1),ArrowRight:Ct("horiz",1),ArrowUp:Ct("vert",-1),ArrowDown:Ct("vert",1),"Shift-ArrowLeft":vt("horiz",-1),"Shift-ArrowRight":vt("horiz",1),"Shift-ArrowUp":vt("vert",-1),"Shift-ArrowDown":vt("vert",1),Backspace:pt,"Mod-Backspace":pt,Delete:pt,"Mod-Delete":pt});function bt(t,e,o){return!o.eq(t.selection)&&(e&&e(t.tr.setSelection(o).scrollIntoView()),!0)}function Ct(t,o){return(n,l,r)=>{if(!r)return!1;const s=n.selection;if(s instanceof H)return bt(n,l,e.near(s.$headCell,o));if("horiz"!=t&&!s.empty)return!1;const i=$t(r,t,o);if(null==i)return!1;if("horiz"==t)return bt(n,l,e.near(n.doc.resolve(s.head+o),o));{const r=n.doc.resolve(i),s=E(r,t,o);let a;return a=s?e.near(s,1):o<0?e.near(n.doc.resolve(r.before(-1)),-1):e.near(n.doc.resolve(r.after(-1)),1),bt(n,l,a)}}}function vt(t,e){return(o,n,l)=>{if(!l)return!1;const r=o.selection;let s;if(r instanceof H)s=r;else{const n=$t(l,t,e);if(null==n)return!1;s=new H(o.doc.resolve(n))}const i=E(s.$headCell,t,e);return!!i&&bt(o,n,new H(s.$anchorCell,i))}}function yt(t,e){const o=y(t.state.doc.resolve(e));return!!o&&(t.dispatch(t.state.tr.setSelection(new H(o))),!0)}function At(t,e,o){if(!A(t.state))return!1;let n=dt(o);const l=t.state.selection;if(l instanceof H){n||(n={width:1,height:1,rows:[s.from(ht(C(t.state.schema).cell,o))]});const e=l.$anchorCell.node(-1),r=l.$anchorCell.start(-1),i=u.get(e).rectBetween(l.$anchorCell.pos-r,l.$headCell.pos-r);return n=ft(n,i.right-i.left,i.bottom-i.top),wt(t.state,t.dispatch,r,i,n),!0}if(n){const e=S(t.state),o=e.start(-1);return wt(t.state,t.dispatch,o,u.get(e.node(-1)).findCell(e.pos-o),n),!0}return!1}function St(t,e){var o;if(e.ctrlKey||e.metaKey)return;const n=Mt(t,e.target);let l;if(e.shiftKey&&t.state.selection instanceof H)r(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&n&&null!=(l=y(t.state.selection.$anchor))&&(null==(o=Rt(t,e))?void 0:o.pos)!=l.pos)r(l,e),e.preventDefault();else if(!n)return;function r(e,o){let n=Rt(t,o);const l=null==v.getState(t.state);if(!n||!N(e,n)){if(!l)return;n=e}const r=new H(e,n);if(l||!t.state.selection.eq(r)){const o=t.state.tr.setSelection(r);l&&o.setMeta(v,e.pos),t.dispatch(o)}}function s(){t.root.removeEventListener("mouseup",s),t.root.removeEventListener("dragstart",s),t.root.removeEventListener("mousemove",i),null!=v.getState(t.state)&&t.dispatch(t.state.tr.setMeta(v,-1))}function i(o){const l=o,i=v.getState(t.state);let a;if(null!=i)a=t.state.doc.resolve(i);else if(Mt(t,l.target)!=n&&(a=Rt(t,e),!a))return s();a&&r(a,l)}t.root.addEventListener("mouseup",s),t.root.addEventListener("dragstart",s),t.root.addEventListener("mousemove",i)}function $t(t,e,n){if(!(t.state.selection instanceof o))return null;const{$head:l}=t.state.selection;for(let o=l.depth-1;o>=0;o--){const r=l.node(o);if((n<0?l.index(o):l.indexAfter(o))!=(n<0?0:r.childCount))return null;if("cell"==r.type.spec.tableRole||"header_cell"==r.type.spec.tableRole){const r=l.before(o),s="vert"==e?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(s)?r:null}}return null}function Mt(t,e){for(;e&&e!=t.dom;e=e.parentNode)if("TD"==e.nodeName||"TH"==e.nodeName)return e;return null}function Rt(t,e){const o=t.posAtCoords({left:e.clientX,top:e.clientY});return o&&o?y(t.state.doc.resolve(o.pos)):null}var Nt=class{constructor(t,e){this.node=t,this.defaultCellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${e}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),zt(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type==this.node.type&&(this.node=t,zt(t,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(t){return"attributes"==t.type&&(t.target==this.table||this.colgroup.contains(t.target))}};function zt(t,e,o,n,l,r){var s;let i=0,a=!0,c=e.firstChild;const p=t.firstChild;if(p){for(let t=0,o=0;t<p.childCount;t++){const{colspan:s,colwidth:d}=p.child(t).attrs;for(let t=0;t<s;t++,o++){const s=l==o?r:d&&d[t],p=s?s+"px":"";if(i+=s||n,s||(a=!1),c)c.style.width!=p&&(c.style.width=p),c=c.nextSibling;else{const t=document.createElement("col");t.style.width=p,e.appendChild(t)}}}for(;c;){const t=c.nextSibling;null==(s=c.parentNode)||s.removeChild(c),c=t}a?(o.style.width=i+"px",o.style.minWidth=""):(o.style.width="",o.style.minWidth=i+"px")}}var xt=new t("tableColumnResizing");function Et({handleWidth:t=5,cellMinWidth:e=25,defaultCellMinWidth:o=100,View:n=Nt,lastColumnResizable:r=!0}={}){const s=new l({key:xt,state:{init(t,e){var l,r;const i=null==(r=null==(l=s.spec)?void 0:l.props)?void 0:r.nodeViews,a=C(e.schema).table.name;return n&&i&&(i[a]=(t,e)=>new n(t,o,e)),new kt(-1,!1)},apply:(t,e)=>e.apply(t)},props:{attributes:t=>{const e=xt.getState(t);return e&&e.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(e,o)=>{!function(t,e,o,n){if(!t.editable)return;const l=xt.getState(t.state);if(!l)return;if(!l.dragging){const r=function(t){for(;t&&"TD"!=t.nodeName&&"TH"!=t.nodeName;)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}(e.target);let s=-1;if(r){const{left:n,right:l}=r.getBoundingClientRect();e.clientX-n<=o?s=_t(t,e,"left",o):l-e.clientX<=o&&(s=_t(t,e,"right",o))}if(s!=l.activeHandle){if(!n&&-1!==s){const e=t.state.doc.resolve(s),o=e.node(-1),n=u.get(o),l=e.start(-1);if(n.colCount(e.pos-l)+e.nodeAfter.attrs.colspan-1==n.width-1)return}Ht(t,s)}}}(e,o,t,r)},mouseleave:t=>{!function(t){if(!t.editable)return;const e=xt.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&Ht(t,-1)}(t)},mousedown:(t,n)=>{!function(t,e,o,n){var l;if(!t.editable)return!1;const r=null!=(l=t.dom.ownerDocument.defaultView)?l:window,s=xt.getState(t.state);if(!s||-1==s.activeHandle||s.dragging)return!1;const i=t.state.doc.nodeAt(s.activeHandle),a=function(t,e,{colspan:o,colwidth:n}){const l=n&&n[n.length-1];if(l)return l;const r=t.domAtPos(e);let s=r.node.childNodes[r.offset].offsetWidth,i=o;if(n)for(let t=0;t<o;t++)n[t]&&(s-=n[t],i--);return s/i}(t,s.activeHandle,i.attrs);function c(e){r.removeEventListener("mouseup",c),r.removeEventListener("mousemove",p);const n=xt.getState(t.state);(null==n?void 0:n.dragging)&&(!function(t,e,o){const n=t.state.doc.resolve(e),l=n.node(-1),r=u.get(l),s=n.start(-1),i=r.colCount(n.pos-s)+n.nodeAfter.attrs.colspan-1,a=t.state.tr;for(let t=0;t<r.height;t++){const e=t*r.width+i;if(t&&r.map[e]==r.map[e-r.width])continue;const n=r.map[e],c=l.nodeAt(n).attrs,p=1==c.colspan?0:i-r.colCount(n);if(c.colwidth&&c.colwidth[p]==o)continue;const d=c.colwidth?c.colwidth.slice():Ot(c.colspan);d[p]=o,a.setNodeMarkup(s+n,null,{...c,colwidth:d})}a.docChanged&&t.dispatch(a)}(t,n.activeHandle,Dt(n.dragging,e,o)),t.dispatch(t.state.tr.setMeta(xt,{setDragging:null})))}function p(e){if(!e.which)return c(e);const l=xt.getState(t.state);if(l&&l.dragging){const r=Dt(l.dragging,e,o);Lt(t,l.activeHandle,r,n)}}t.dispatch(t.state.tr.setMeta(xt,{setDragging:{startX:e.clientX,startWidth:a}})),Lt(t,s.activeHandle,a,n),r.addEventListener("mouseup",c),r.addEventListener("mousemove",p),e.preventDefault()}(t,n,e,o)}},decorations:t=>{const e=xt.getState(t);if(e&&e.activeHandle>-1)return function(t,e){var o;const n=[],l=t.doc.resolve(e),r=l.node(-1);if(!r)return a.empty;const s=u.get(r),i=l.start(-1),p=s.colCount(l.pos-i)+l.nodeAfter.attrs.colspan-1;for(let e=0;e<s.height;e++){const l=p+e*s.width;if(!(p!=s.width-1&&s.map[l]==s.map[l+1]||0!=e&&s.map[l]==s.map[l-s.width])){const e=s.map[l],a=i+e+r.nodeAt(e).nodeSize-1,p=document.createElement("div");p.className="column-resize-handle",(null==(o=xt.getState(t))?void 0:o.dragging)&&n.push(c.node(i+e,i+e+r.nodeAt(e).nodeSize,{class:"column-resize-dragging"})),n.push(c.widget(a,p))}}return a.create(t.doc,n)}(t,e.activeHandle)},nodeViews:{}}});return s}var kt=class t{constructor(t,e){this.activeHandle=t,this.dragging=e}apply(e){const o=this,n=e.getMeta(xt);if(n&&null!=n.setHandle)return new t(n.setHandle,!1);if(n&&void 0!==n.setDragging)return new t(o.activeHandle,n.setDragging);if(o.activeHandle>-1&&e.docChanged){let n=e.mapping.map(o.activeHandle,-1);return M(e.doc.resolve(n))||(n=-1),new t(n,o.dragging)}return o}};function _t(t,e,o,n){const l="right"==o?-n:n,r=t.posAtCoords({left:e.clientX+l,top:e.clientY});if(!r)return-1;const{pos:s}=r,i=y(t.state.doc.resolve(s));if(!i)return-1;if("right"==o)return i.pos;const a=u.get(i.node(-1)),c=i.start(-1),p=a.map.indexOf(i.pos-c);return p%a.width==0?-1:c+a.map[p-1]}function Dt(t,e,o){const n=e.clientX-t.startX;return Math.max(o,t.startWidth+n)}function Ht(t,e){t.dispatch(t.state.tr.setMeta(xt,{setHandle:e}))}function Lt(t,e,o,n){const l=t.state.doc.resolve(e),r=l.node(-1),s=l.start(-1),i=u.get(r).colCount(l.pos-s)+l.nodeAfter.attrs.colspan-1;let a=t.domAtPos(l.start(-1)).node;for(;a&&"TABLE"!=a.nodeName;)a=a.parentNode;a&&zt(r,a.firstChild,a,n,i,o)}function Ot(t){return Array(t).fill(0)}function Ft({allowTableNodeSelection:t=!1}={}){return new l({key:v,state:{init:()=>null,apply(t,e){const o=t.getMeta(v);if(null!=o)return-1==o?null:o;if(null==e||!t.docChanged)return e;const{deleted:n,pos:l}=t.mapping.mapResult(e);return n?null:l}},props:{decorations:O,handleDOMEvents:{mousedown:St},createSelectionBetween:t=>null!=v.getState(t.state)?t.state.selection:null,handleTripleClick:yt,handleKeyDown:gt,handlePaste:At},appendTransaction:(e,n,l)=>function(t,e,n){const l=(e||t).selection,s=(e||t).doc;let i,a;if(l instanceof r&&(a=l.node.type.spec.tableRole)){if("cell"==a||"header_cell"==a)i=H.create(s,l.from);else if("row"==a){const t=s.resolve(l.from+1);i=H.rowSelection(t,t)}else if(!n){const t=u.get(l.node),e=l.from+1,o=e+t.map[t.width*t.height-1];i=H.create(s,e+1,o)}}else l instanceof o&&function({$from:t,$to:e}){if(t.pos==e.pos||t.pos<e.pos-6)return!1;let o=t.pos,n=e.pos,l=t.depth;for(;l>=0&&!(t.after(l+1)<t.end(l));l--,o++);for(let t=e.depth;t>=0&&!(e.before(t+1)>e.start(t));t--,n--);return o==n&&/row|table/.test(t.node(l).type.spec.tableRole)}(l)?i=o.create(s,l.from):l instanceof o&&function({$from:t,$to:e}){let o,n;for(let e=t.depth;e>0;e--){const n=t.node(e);if("cell"===n.type.spec.tableRole||"header_cell"===n.type.spec.tableRole){o=n;break}}for(let t=e.depth;t>0;t--){const o=e.node(t);if("cell"===o.type.spec.tableRole||"header_cell"===o.type.spec.tableRole){n=o;break}}return o!==n&&0===e.parentOffset}(l)&&(i=o.create(s,l.$from.start(),l.$from.end()));return i&&(e||(e=t.tr)).setSelection(i),e}(l,W(l,n),t)})}export{L as CellBookmark,H as CellSelection,kt as ResizeState,u as TableMap,Nt as TableView,ft as __clipCells,wt as __insertCells,dt as __pastedCells,_ as addColSpan,I as addColumn,V as addColumnAfter,X as addColumnBefore,J as addRow,U as addRowAfter,j as addRowBefore,y as cellAround,$ as cellNear,x as colCount,D as columnIsHeader,Et as columnResizing,xt as columnResizingPluginKey,pt as deleteCellSelection,P as deleteColumn,G as deleteRow,ct as deleteTable,z as findCell,W as fixTables,F as fixTablesKey,at as goToNextCell,At as handlePaste,N as inSameTable,A as isInTable,Z as mergeCells,R as moveCellForward,E as nextCell,M as pointsAtCell,k as removeColSpan,K as removeColumn,Y as removeRow,q as rowIsHeader,T as selectedRect,S as selectionCell,ot as setCellAttr,tt as splitCell,et as splitCellWithType,Ft as tableEditing,v as tableEditingKey,C as tableNodeTypes,b as tableNodes,lt as toggleHeader,it as toggleHeaderCell,st as toggleHeaderColumn,rt as toggleHeaderRow,zt as updateColumnsOnResize};export default null;
//# sourceMappingURL=/sm/b8cca4e25ffa2fdba4da973ede2e67dc87bfe5179923245f956890e4f943a94a.map