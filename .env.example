# ===================================
# NTEOK 환경 변수 설정 예시
# ===================================
# 이 파일을 .env로 복사하고 실제 값으로 수정하세요.
# cp .env.example .env

# -----------------------------------
# 서버 설정
# -----------------------------------
PORT=3000
NODE_ENV=development

# -----------------------------------
# 데이터베이스 설정
# -----------------------------------
# 보안: 프로덕션(운영) 환경에서는 DB 자격증명을 반드시 설정해야 하며, 기본값(root/admin) 사용 시 서버가 시작되지 않습니다(fail-closed).
# 개발 환경에서 편의상 기본값 사용을 원하면 아래 옵션을 켜세요(비권장, localhost DB만 허용).
# ALLOW_INSECURE_DB_DEFAULTS=true

DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=admin
DB_NAME=nteok

# -----------------------------------
# 관리자 계정 설정
# -----------------------------------
ADMIN_USERNAME=admin
# 보안: 강력한 비밀번호를 설정하세요 (10자 이상, 대/소문자/숫자/특수문자 중 3종 이상).
# 운영(production) 환경에서 약한 비밀번호 사용 시 서버가 시작되지 않습니다.
ADMIN_PASSWORD=your_secure_password_here

# (선택) 초기 부트스트랩 시 생성된 임시 비밀번호를 로그에 출력할지 여부 (기본값: false)
# SHOW_BOOTSTRAP_PASSWORD_IN_LOGS=true

# BCrypt 솔트 라운드 (기본값: 12)
BCRYPT_SALT_ROUNDS=12

# -----------------------------------
# 애플리케이션 URL
# -----------------------------------
BASE_URL=http://localhost:3000

# -----------------------------------
# HTTPS 자동 인증서 설정 (DuckDNS + Let's Encrypt)
# -----------------------------------
# HTTPS를 사용하려면 아래 설정을 활성화하세요.
# DuckDNS 계정이 필요합니다: https://www.duckdns.org

# DuckDNS 도메인 (예: myapp.duckdns.org)
# DUCKDNS_DOMAIN=your-domain.duckdns.org

# DuckDNS API 토큰
# DUCKDNS_TOKEN=your-duckdns-token-here

# Let's Encrypt 인증서 이메일 (선택 사항)
# CERT_EMAIL=admin@example.com

# HTTP -> HTTPS 자동 리다이렉트 활성화 (포트 80 사용)
# 주의: 포트 80은 관리자 권한이 필요할 수 있습니다.
# ENABLE_HTTP_REDIRECT=true

# HTTPS 실패 시 서버를 중단(fail-closed)하도록 강제 (기본: production에서 자동 적용)
# REQUIRE_HTTPS=true
# (비권장) production에서 HTTPS 실패 시 HTTP로 폴백을 허용 (긴급 상황에서만)
# ALLOW_INSECURE_HTTP_FALLBACK=true

# -----------------------------------
# 사용 예시
# -----------------------------------
# HTTPS 설정 예시:
# DUCKDNS_DOMAIN=mynteok.duckdns.org
# DUCKDNS_TOKEN=abc123-def456-ghi789
# CERT_EMAIL=admin@example.com
# PORT=443
# BASE_URL=https://mynteok.duckdns.org
# ENABLE_HTTP_REDIRECT=true

# -----------------------------------
# 보안 하드닝 (선택)
# -----------------------------------
# 로그인/회원가입(Login CSRF) 방지용 허용 Origin 목록 (콤마로 구분)
# 비워두면 BASE_URL만 허용합니다.
# ALLOWED_ORIGINS=http://localhost:3000,https://your-domain.example

# 2FA(TOTP) 공유 비밀키(DB 저장) 암호화 키
# - 32 bytes (256-bit) 키를 base64 또는 64자리 hex로 설정
# - 예: openssl rand -base64 32
# TOTP_SECRET_ENC_KEY=

# 백업 Import(Zip Bomb) 방지용 제한값
# BACKUP_IMPORT_MAX_ENTRIES=5000
# BACKUP_IMPORT_MAX_TOTAL_UNCOMPRESSED=314572800   # 300MB
# BACKUP_IMPORT_MAX_ENTRY_UNCOMPRESSED=20971520    # 20MB

# 별도 호스트 LB(로드밸런서)/Cloudflare 등 원격 프록시 사용 시, 반드시 프록시 IP 대역 지정 필요
# 단 별도의 원격 프록시 사용 없이 직접 접속 방식이면 지정 필요 X (프록시 보안 용 설정값)
# 예: 사내 LB 대역이 10.0.0.0/8 이고, 그 LB만 서버에 직접 붙는 구조일 때
# 절대 권장하지 않음: TRUST_PROXY=on (X-Forwarded-* 헤더 전체 신뢰 → IP 스푸핑 위험)
# TRUST_PROXY=auto
# TRUST_PROXY_CIDRS=10.0.0.0/8

# 국가별 화이트리스트 기능에서 사설/로컬 IP를 어떻게 처리할지를 정하는 플래그
# true : 사설/로컬 IP는 국가 확인 우회하고 그냥 바로 허용
# false (또는 미설정, 프로덕션 기본값) : 사설/로컬 IP면 국가 체크 우회하지 않고 차단(안전 기본값)
# COUNTRY_WHITELIST_ALLOW_PRIVATE_IP=true

# 쿠키 보안 설정 (선택)
# FORCE_SECURE_COOKIES=true    # 운영(production) 환경 기본값: true. 쿠키에 Secure/__Host- 강제.
# ALLOW_INSECURE_COOKIES=false  # Secure 쿠키를 명시적으로 해제할 때만 true (비권장).

# DoS 완화를 위한 JSON 크기 제한 (기본값 : 1mb)
# JSON_BODY_LIMIT=1mb

# -----------------------------------
# 보안: 업로드 자원 고갈(DoS) 방지용 사용자별 총량 / 횟수 제한
# -----------------------------------
# - 총 첨부파일 업로드 용량(사용자당, 기본 1GB)
# MAX_PAPERCLIP_BYTES_PER_USER=1gb

# - 첨부파일 업로드 요청 횟수 제한(사용자당/시간, 기본 60)
# FILE_UPLOAD_MAX_PER_HOUR=60

# -----------------------------------
# WebSocket DoS 방어(선택) - 실시간 협업(Yjs) 하드닝
# -----------------------------------
# 메시지 레이트 제한(기본: 10초 윈도우)
# WS_MSG_RATE_WINDOW_MS=10000
# WS_MSG_RATE_MAX=400              # window당 전체 메시지 수
# WS_YJS_RATE_MAX=200              # window당 yjs-update 수
# WS_AWARENESS_RATE_MAX=300        # window당 awareness-update 수

# 크기 제한
# WS_MAX_YJS_UPDATE_BYTES=524288   # 512KB (yjs-update 디코딩 후 바이트 상한)
# WS_MAX_YJS_STATE_BYTES=1048576   # 1MB  (DB yjs_state 저장 상한)

# -----------------------------------
# 보안: SSRF 하드닝 (북마크/이미지 프록시)
# -----------------------------------
# SSRF 및 오픈 프록시 악용 방지를 위해 허용된 호스트만 원격 요청을 허용합니다.
# 콤마(,)로 구분하며, 정확한 호스트명 또는 와일드카드 서브도메인(*.example.com)을 지원합니다.
# 운영 환경에서는 반드시 신뢰할 수 있는 도메인만 추가하세요 (Fail-Closed).
BOOKMARK_METADATA_HOST_ALLOWLIST=example.com,*.wikipedia.org,*.github.com
IMAGE_PROXY_HOST_ALLOWLIST=images.example.com,*.wikimedia.org,*.githubusercontent.com

# (선택) 아웃바운드 허용 포트 (기본값: 80, 443)
# OUTBOUND_HTTP_ALLOWED_PORTS=80,443

# (선택) 메타데이터/이미지 프록시 타임아웃 및 크기 제한
# METADATA_FETCH_TIMEOUT_MS=5000
# METADATA_MAX_BYTES=524288
# IMAGE_PROXY_TIMEOUT_MS=10000
# IMAGE_PROXY_MAX_BYTES=5242880

# -----------------------------------
# 주의사항
# -----------------------------------
# 1. .env 파일은 절대 Git에 커밋하지 마세요!
# 2. 프로덕션 환경에서는 강력한 비밀번호를 사용하세요.
# 3. DuckDNS 도메인은 반드시 .duckdns.org로 끝나야 합니다.
# 4. HTTPS를 사용하려면 서버가 공개 IP를 가지고 있어야 합니다.
# 5. Let's Encrypt DNS Challenge는 최대 2분 정도 소요될 수 있습니다.
